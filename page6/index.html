<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> watermint.org &middot; Takayuki Okazaki's note </title> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/watermint-logo.png"> <link rel="shortcut icon" href="/public/watermint-logo.png"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <style>*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:serif;font-size:14px;line-height:1.8}@media(min-width:38em){html{font-size:20px}}body{color:#515151;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#268bd2;text-decoration:none}a strong{color:inherit}a:hover,a:focus{text-decoration:underline}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:bold;line-height:1.25;color:#313131;text-rendering:optimizeLegibility}h1{font-size:1.5rem;margin-top:1.6rem;margin-bottom:1.6rem}h2{margin-top:1.6rem;font-size:1.3rem}h3{margin-top:1.6rem;font-size:1.2rem}h4,h5,h6{margin-top:1rem;font-size:1rem}p{margin-top:0;margin-bottom:1rem}strong{color:#303030}ul,ol,dl{margin-top:0;margin-bottom:1rem}dt{font-weight:bold}dd{margin-bottom:.5rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee;border-bottom:1px solid #fff}abbr{font-size:85%;font-weight:bold;color:#555;text-transform:uppercase}abbr[title]{cursor:help;border-bottom:1px dotted #e5e5e5}code,pre{font-family:Menlo,Monaco,"Courier New",monospace}code{padding:.25em .5em;font-size:85%;color:#bf616a;background-color:#f9f9f9;border-radius:3px}pre{display:block;margin-top:0;margin-bottom:1rem;padding:1rem;font-size:.8rem;line-height:1.4;white-space:pre;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background-color:#f9f9f9}pre code{padding:0;font-size:100%;color:inherit;background-color:transparent}.highlight{margin-bottom:1rem;border-radius:4px}.highlight pre{margin-bottom:0}.gist .gist-file{font-family:Menlo,Monaco,"Courier New",monospace!important}.gist .markdown-body{padding:15px}.gist pre{padding:0;background-color:transparent}.gist .gist-file .gist-data{font-size:.8rem!important;line-height:1.4}.gist code{padding:0;color:inherit;background-color:transparent;border-radius:0}blockquote{padding:.5rem 1rem;margin:.8rem 0;color:#7a7a7a;border-left:.25rem solid #e5e5e5}blockquote p:last-child{margin-bottom:0}@media(min-width:30em){blockquote{padding-right:5rem;padding-left:1.25rem}}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;border:1px solid #e5e5e5;border-collapse:collapse}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}.lead{font-size:1.25rem;font-weight:300}.message{margin-bottom:1rem;padding:1rem;color:#717171;background-color:#f9f9f9}.container{max-width:38rem;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:#c0c0c0;letter-spacing:0}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.post-tags{display:block;margin-top:-.5rem;margin-bottom:1rem;text-align:right}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:"PT Sans",Helvetica,Arial,sans-serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media(min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}html,body{overflow-x:hidden;line-height:1.9em}html{font-family:serif}h1,h2,h3,h4,h5,h6{font-weight:400;color:#313131}.wrap{position:relative;width:100%}.container{max-width:28rem}@media(min-width:38em){.container{max-width:32rem}}@media(min-width:56em){.container{max-width:38rem}}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem;border-bottom:1px solid #eee}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:#c0c0c0;letter-spacing:0}@media(max-width:48em){.masthead-title{text-align:center}.masthead-title small{display:none}}.sidebar{position:fixed;top:0;bottom:0;left:-14rem;width:14rem;visibility:hidden;overflow-y:auto;font-family:serif;font-size:.875rem;line-height:1.4em;color:rgba(255,255,255,.6);background-color:#202020;-webkit-transition:all .3s ease-in-out;transition:all .3s ease-in-out}
@media(min-width:30em){.sidebar{font-size:.75rem}}.sidebar a{font-weight:normal;color:#fff}.sidebar-item{padding:1rem}.sidebar-item p:last-child{margin-bottom:0}.sidebar-nav{border-bottom:1px solid rgba(255,255,255,.1)}.sidebar-nav-item{display:block;padding:.5rem 1rem;border-top:1px solid rgba(255,255,255,.1)}.sidebar-nav-item.active,a.sidebar-nav-item:hover,a.sidebar-nav-item:focus{text-decoration:none;background-color:rgba(255,255,255,.1);border-color:transparent}@media(min-width:48em){.sidebar-item{padding:1.5rem}.sidebar-nav-item{padding-left:1.5rem;padding-right:1.5rem}}.sidebar-checkbox{position:absolute;opacity:0;-webkit-user-select:none;-moz-user-select:none;user-select:none}.sidebar-toggle{position:absolute;top:.8rem;left:1rem;display:block;padding:.25rem .75rem;color:#555;border-radius:.25rem;cursor:pointer}.sidebar-toggle:before{display:inline-block;width:1rem;height:.75rem;content:"";background-image:-webkit-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:-moz-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:-ms-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%)}.sidebar-toggle:active,#sidebar-checkbox:focus ~ .sidebar-toggle,#sidebar-checkbox:checked ~ .sidebar-toggle{color:#fff}.sidebar-toggle:active:before,#sidebar-checkbox:focus ~ .sidebar-toggle:before,#sidebar-checkbox:checked ~ .sidebar-toggle:before{background-image:-webkit-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:-moz-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:-ms-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%)}@media(min-width:30.1em){.sidebar-toggle{position:fixed}}@media print{.sidebar-toggle{display:none}}.wrap,.sidebar,.sidebar-toggle{-webkit-backface-visibility:hidden;-ms-backface-visibility:hidden;backface-visibility:hidden}.wrap,.sidebar-toggle{-webkit-transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out}#sidebar-checkbox:checked+.sidebar{z-index:10;visibility:visible}#sidebar-checkbox:checked ~ .sidebar,#sidebar-checkbox:checked ~ .wrap,#sidebar-checkbox:checked ~ .sidebar-toggle{-webkit-transform:translateX(14rem);-ms-transform:translateX(14rem);transform:translateX(14rem)}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media(min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}.layout-reverse .sidebar{left:auto;right:-14rem}.layout-reverse .sidebar-toggle{left:auto;right:1rem}.layout-reverse #sidebar-checkbox:checked ~ .sidebar,.layout-reverse #sidebar-checkbox:checked ~ .wrap,.layout-reverse #sidebar-checkbox:checked ~ .sidebar-toggle{-webkit-transform:translateX(-14rem);-ms-transform:translateX(-14rem);transform:translateX(-14rem)}.theme-base-08 .sidebar,.theme-base-08 .sidebar-toggle:active,.theme-base-08 #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#ac4142}.theme-base-08 .container a,.theme-base-08 .sidebar-toggle,.theme-base-08 .related-posts li a:hover{color:#ac4142}.theme-base-09 .sidebar,.theme-base-09 .sidebar-toggle:active,.theme-base-09 #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#d28445}.theme-base-09 .container a,.theme-base-09 .sidebar-toggle,.theme-base-09 .related-posts li a:hover{color:#d28445}.theme-base-0a .sidebar,.theme-base-0a .sidebar-toggle:active,.theme-base-0a #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#f4bf75}
.theme-base-0a .container a,.theme-base-0a .sidebar-toggle,.theme-base-0a .related-posts li a:hover{color:#f4bf75}.theme-base-0b .sidebar,.theme-base-0b .sidebar-toggle:active,.theme-base-0b #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#90a959}.theme-base-0b .container a,.theme-base-0b .sidebar-toggle,.theme-base-0b .related-posts li a:hover{color:#90a959}.theme-base-0c .sidebar,.theme-base-0c .sidebar-toggle:active,.theme-base-0c #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#75b5aa}.theme-base-0c .container a,.theme-base-0c .sidebar-toggle,.theme-base-0c .related-posts li a:hover{color:#75b5aa}.theme-base-0d .sidebar,.theme-base-0d .sidebar-toggle:active,.theme-base-0d #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#6a9fb5}.theme-base-0d .container a,.theme-base-0d .sidebar-toggle,.theme-base-0d .related-posts li a:hover{color:#6a9fb5}.theme-base-0e .sidebar,.theme-base-0e .sidebar-toggle:active,.theme-base-0e #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#aa759f}.theme-base-0e .container a,.theme-base-0e .sidebar-toggle,.theme-base-0e .related-posts li a:hover{color:#aa759f}.theme-base-0f .sidebar,.theme-base-0f .sidebar-toggle:active,.theme-base-0f #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#8f5536}.theme-base-0f .container a,.theme-base-0f .sidebar-toggle,.theme-base-0f .related-posts li a:hover{color:#8f5536}.sidebar-overlay #sidebar-checkbox:checked ~ .wrap{-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0)}.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar-toggle{box-shadow:0 0 0 .25rem #fff}.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar{box-shadow:.25rem 0 .5rem rgba(0,0,0,.1)}.layout-reverse.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar{box-shadow:-.25rem 0 .5rem rgba(0,0,0,.1)}.highlight table td{padding:5px}.highlight table pre{margin:0}.highlight,.highlight .w{color:#586e75}.highlight .err{color:#002b36;background-color:#dc322f}.highlight .c,.highlight .cd,.highlight .cm,.highlight .c1,.highlight .cs{color:#657b83}.highlight .cp{color:#b58900}.highlight .nt{color:#b58900}.highlight .o,.highlight .ow{color:#93a1a1}.highlight .p,.highlight .pi{color:#93a1a1}.highlight .gi{color:#859900}.highlight .gd{color:#dc322f}.highlight .gh{color:#268bd2;background-color:#002b36;font-weight:bold}.highlight .k,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .kv{color:#6c71c4}.highlight .kc{color:#cb4b16}.highlight .kt{color:#cb4b16}.highlight .kd{color:#cb4b16}.highlight .s,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .s2,.highlight .sh,.highlight .sx,.highlight .s1{color:#859900}.highlight .sr{color:#2aa198}.highlight .si{color:#d33682}.highlight .se{color:#d33682}.highlight .nn{color:#b58900}.highlight .nc{color:#b58900}.highlight .no{color:#b58900}.highlight .na{color:#268bd2}.highlight .m,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .il,.highlight .mo,.highlight .mb,.highlight .mx{color:#859900}.highlight .ss{color:#859900}.copyright{font-size:.8em;font-style:italic;color:#555}</style> </head> <body class="theme-base-09"> <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"> <div class="sidebar" id="sidebar"> <div class="sidebar-item"> <p>Travel, camera, photo, and technical things. I work at Dropbox. Thoughts are my own.</p> </div> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Home</a> <a class="sidebar-nav-item" href="/about/">About</a> <a class="sidebar-nav-item" href="/archive/">Archive</a> <a class="sidebar-nav-item" href="/tags/">Tags</a> <a class="sidebar-nav-item" href="/atom.xml">Feed</a> <a class="sidebar-nav-item" href="https://github.com/watermint">Github</a> </nav> <div class="sidebar-item"> <p> &copy; 2005-2022 Takayuki Okazaki </p> </div> </div> <div class="wrap"> <div class="masthead"> <div class="container"> <h3 class="masthead-title"> <a href="/" title="Home">watermint.org</a> <small>- Takayuki Okazaki's note</small> </h3> </div> </div> <div class="container content"> <div class="posts"> <div class="post"> <h1 class="post-title"> <a href="/2017/12/12/travel-sim/"> 海外旅行とSIMカード </a> </h1> <span class="post-date"> 12th December 2017</span> <span class="post-tags"> #<a href="/tags/canada">canada</a> #<a href="/tags/finland">finland</a> #<a href="/tags/ireland">ireland</a> #<a href="/tags/mobile">mobile</a> #<a href="/tags/sim">sim</a> #<a href="/tags/travel">travel</a> #<a href="/tags/usa">usa</a> </span> <p>海外旅行または海外出張に行くとき、忘れてはならないのはパスポートです。次に大事なのは財布だと思いますが、いまや財布と同じぐらいモバイルインターネット接続の重要度が上がってきていると思います。地図を見るにしても、タクシーに乗るにしてもスマホとアプリに頼り切る生活になっているからでしょう。</p> <p>今年は出張と旅行で何度か海外に行きましたが、その際のSIMカード利用をレビューしたいと思います。数年前まではWifiルータを日本でレンタルしていくこともありましたが、最近はほとんどSIMフリー携帯/iPad+現地SIMです。 (注: 為替レートは執筆時点でのもの)</p> <h1 id="台湾">台湾</h1> <p>ここ数年、ゴールデンウィーク頃に台湾へ遊びに行っています。台湾はSIMが手に入れやすく、たとえば台北の松山空港でも荷物を受け取り、両替を済ませたらすぐ近くにSIMカードを売っているカウンターがあります。特にこだわりはありませんが、だいたいいつも中華電信の1週間500台湾ドル(約1900円)でインターネット使い放題のSIMを買っています。カウンターでパスポートとSIMフリー携帯を渡すとSIMを差し替えて設定してくれます。</p> <p>速度も満足でき、特に電波状況がわるくて不便な目にあったということもありませんでした。</p> <h1 id="フィンランドアイルランドイギリス">フィンランド、アイルランド、イギリス</h1> <p>今年はヨーロッパ方面に行く際には<a href="https://www.mtxc.eu/">MTX Connect</a>のSIMを使っています。日本からもオンラインでSIMを購入することができます。海外からの発送になるので出発の3〜4週間前ぐらいに買っておくと安心でしょう。</p> <p>SIMカードは7ユーロ(約940円)程度で購入できます。7ユーロで買いますが、これはあとからパケット代金に充てることができるので実質的には無料と考えてもいいかもしれません。MTX Connectの場合はその後、クレジットカードないしPaypalなどでチャージ(top up)して従量課金または1GB〜3.5GBの定額プランなどを購入して利用します。</p> <p>今年使ったのは1GB・15日(約20ユーロ)と2GB・30日(約40ユーロ)というプランです。フィンランド→アイルランド→イギリスなど複数国を回りましたがSIMを変える必要も無く、キャリアも自動検出されるもので良いのでかなり楽です。</p> <p>接続は4Gではなく3Gになることが多いので、日本で利用するのと比べるとやや見劣りしますが地図を見たり、SNSを見るぐらいならさほど気にならないと思います。</p> <h1 id="アメリカとカナダ">アメリカとカナダ</h1> <p>北米には今年、アメリカ(ニューヨークとインディアナ)とカナダ(トロント)に行きました。同行者分ふくめ2台分準備しました。</p> <h2 id="t-mobileのsim">T-MobileのSIM</h2> <p>ひとつは<a href="http://amzn.to/2At7lTY">T-Mobileの通話とSMS、データ通信高速無制限使い放題</a>というSIMを購入していきました。30日間有効で、カナダ・メキシコは最長15日間利用できるとのことです。価格は6,900円とヨーロッパで使っているSIMと比べるとかなり高い印象です。それでもWifiルータをレンタルするよりは安くすみます。</p> <p>iPhone SEで利用していましたが、速度的にも満足のいくものでした。トロントに移動した際、うまくインターネット接続できなかったのですが日本で使っていたIIJmioの構成プロファイルを消し忘れていたというのに気づいて一件落着しました。</p> <h2 id="mtx-connect">MTX Connect</h2> <p>アメリカの後、すぐにヨーロッパ出張の予定があったのでMTX Connectを使うことにしました。ニューヨークでは実際にMTX Connectを使って特に不自由なく空港でUberを呼んだりするところから、街歩きの際にも利用しました。</p> <p>MTX ConnectのSIMでカバレッジをみるとアメリカやカナダもカバーしているように見えるので、これだけで済ませるつもりでしたが少し誤算がありました。</p> <p><img src="/images/2017-12-12-mtx-connect-coverage.jpg" alt="MTX Connectのカバレッジ"/></p> <p>よくみると注があり、ケベック州のみとのこと。。結局トロントでは利用できず、後述のGigSkyを使うことにしました。</p> <h2 id="apple-simでgigsky">Apple SIMでGigSky</h2> <p>現地でSIMを調達するのも意外とタイムロスになるのでiPad Pro内蔵のApple SIMを使うことにしました。Apple SIMで契約するデータプランは、何かの記事で読んだからか、ものすごく高いという印象があったのですが、北米プラン2GB・30日で4,200円と意外にリーズナブルでした。</p> <p>通信速度、接続状態も良く都市部だけでなく郊外でもストレス無く利用できました。</p> <p>GigSkyのページをみると北米2GB・15日で30ドル(約3,400円)とApple SIMプランよりも若干リーズナブル。日数は減りますが旅程によっては<a href="http://amzn.to/2AsXLQJ">GigSkyのSIM</a>をあらかじめ日本で買っておいてもいいかもしれません。</p> <h1 id="総評">総評</h1> <p>複数国を移動するような旅行の場合、カバレッジの広いGigSkyが圧倒的に便利ですが、旅程によってはMTX Connectも便利です。EU圏内では今年データローミング料金が撤廃されたというような動きもあったので、今後ますます便利なSIMが出てくるかと思います。</p> <p>対応LTEバンドなど携帯電話側の対応も考えなければいけないですが、iPhoneなどカバレッジが広いSIMフリー端末があると、その点でもあまり悩まずすみます。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/12/11/dropbox-api-auth/"> Dropbox API: 認証・認可について </a> </h1> <span class="post-date"> 11th December 2017</span> <span class="post-tags"> #<a href="/tags/api">api</a> #<a href="/tags/dropbox">dropbox</a> #<a href="/tags/dropboxapi">dropboxapi</a> #<a href="/tags/go">go</a> #<a href="/tags/java">java</a> #<a href="/tags/oauth">oauth</a> </span> <p>今回はDropbox APIの認証・認可についてかいつまんでご紹介します。Dropbox APIの認証・認可はOAuth2を利用しています。公式SDKの実装サンプルなどを参考にJavaとGoでの実装例をもとに紹介していきます。</p> <p><a href="/2017/12/08/dropbox-api-overview/">Dropbox APIの概要</a>でもご紹介したとおり、実装前にはアプリケーションの登録が登録が必要です。登録がすんだらApp keyとApp Secretが得られますのでこれらを使いましょう。</p> <h1 id="java">Java</h1> <p>SDKに<a href="https://github.com/dropbox/dropbox-sdk-java/tree/master/examples/authorize">authorize</a>というサンプルがありますのでこれを参考にすると良いでしょう。 一般的なOAuthの流れと比べて変わったところは特にありません。<a href="https://dropbox.github.io/dropbox-sdk-java/api-docs/v2.1.x/">Dropbox SDK JavaのJavadoc</a>に簡単な流れがのっているのでこちらを引用してご紹介します。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// No Redirect Example</span>
<span class="nc">DbxRequestConfig</span> <span class="n">requestConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DbxRequestConfig</span><span class="o">(</span><span class="s">"text-edit/0.1"</span><span class="o">);</span>
<span class="nc">DbxAppInfo</span> <span class="n">appInfo</span> <span class="o">=</span> <span class="nc">DbxAppInfo</span><span class="o">.</span><span class="na">Reader</span><span class="o">.</span><span class="na">readFromFile</span><span class="o">(</span><span class="s">"api.app"</span><span class="o">);</span>
<span class="nc">DbxWebAuth</span> <span class="n">auth</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DbxWebAuth</span><span class="o">(</span><span class="n">requestConfig</span><span class="o">,</span> <span class="n">appInfo</span><span class="o">);</span>
<span class="nc">DbxWebAuth</span><span class="o">.</span><span class="na">Request</span> <span class="n">authRequest</span> <span class="o">=</span> <span class="nc">DbxWebAuth</span><span class="o">.</span><span class="na">newRequestBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withNoRedirect</span><span class="o">()</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">String</span> <span class="n">authorizeUrl</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="na">authorize</span><span class="o">(</span><span class="n">authRequest</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"1. Go to "</span> <span class="o">+</span> <span class="n">authorizeUrl</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"2. Click \"Allow\" (you might have to log in first)."</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"3. Copy the authorization code."</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Enter the authorization code here: "</span><span class="o">);</span>
<span class="nc">String</span> <span class="n">code</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">console</span><span class="o">().</span><span class="na">readLine</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="nc">DbxAuthFinish</span> <span class="n">authFinish</span> <span class="o">=</span> <span class="n">webAuth</span><span class="o">.</span><span class="na">finishFromCode</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
    <span class="nc">DbxClientV2</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DbxClientV2</span><span class="o">(</span><span class="n">requestConfig</span><span class="o">,</span> <span class="n">authFinish</span><span class="o">.</span><span class="na">getAccessToken</span><span class="o">());</span>
    <span class="c1">// APIを使った処理</span>
<span class="o">}</span>
</code></pre></div></div> <p>この例ではApp Key・App Secretをファイルから読み込んでいます。api.appという名前で次のようなJSON形式ファイルを準備しておいてください。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"key"</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="s2">"App keyと置き換え"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"secret"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"App secretと置き換え"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>大まかな流れとしては次の通りです。</p> <ol> <li>設定情報などを準備 (<code class="language-plaintext highlighter-rouge">DbxRequestConfig</code>, <code class="language-plaintext highlighter-rouge">DbxAppInfo</code>)</li> <li>リクエストを準備</li> <li>認証URLを生成し、ユーザーに認可をもとめる</li> <li>コードを受け取りトークンを生成</li> <li><code class="language-plaintext highlighter-rouge">DbxClientV2</code>インスタンスを作成して各種APIコール</li> </ol> <p>設定できるオプションとしては、<code class="language-plaintext highlighter-rouge">DbxRequestConfig</code>にはエラー時の再試行回数などがあります。</p> <h1 id="go">Go</h1> <p>個人的にGoで実装する際には非公式SDKの<a href="https://github.com/dropbox/dropbox-sdk-go-unofficial">dropbox-sdk-go-unofficial</a>を使っています。処理の流れは基本的にJavaでの実装と同じです。OAuth認証・認可処理自体はSDKとは関係なく<a href="https://godoc.org/golang.org/x/oauth2">golang.org/x/oauth2</a>を利用しています。</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">authCfg</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">oauth2</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
	<span class="n">ClientID</span><span class="o">:</span>     <span class="s">"App keyと置き換え"</span><span class="p">,</span>
	<span class="n">ClientSecret</span><span class="o">:</span> <span class="s">"App Secretと置き換え"</span><span class="p">,</span>
	<span class="n">Scopes</span><span class="o">:</span>       <span class="p">[]</span><span class="kt">string</span><span class="p">{},</span>
	<span class="n">Endpoint</span><span class="o">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">Endpoint</span><span class="p">{</span>
		<span class="n">AuthURL</span><span class="o">:</span>  <span class="s">"https://www.dropbox.com/oauth2/authorize"</span><span class="p">,</span>
		<span class="n">TokenURL</span><span class="o">:</span> <span class="s">"https://api.dropboxapi.com/oauth2/token"</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">}</span>
<span class="n">authorizeUrl</span> <span class="o">:=</span> <span class="n">authCfg</span><span class="o">.</span><span class="n">AuthCodeURL</span><span class="p">(</span>
	<span class="s">"csrf-stateの文字列"</span><span class="p">,</span>
	<span class="n">oauth2</span><span class="o">.</span><span class="n">SetAuthURLParam</span><span class="p">(</span><span class="s">"response_type"</span><span class="p">,</span> <span class="s">"code"</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"1. Go to "</span> <span class="o">+</span> <span class="n">authorizeUrl</span><span class="p">);</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"2. Click </span><span class="se">\"</span><span class="s">Allow</span><span class="se">\"</span><span class="s"> (you might have to log in first)."</span><span class="p">);</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"3. Copy the authorization code."</span><span class="p">);</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"Enter the authorization code here: "</span><span class="p">);</span>
<span class="k">var</span> <span class="n">code</span> <span class="kt">string</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="n">code</span><span class="p">)</span>
<span class="n">token</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">authCfg</span><span class="o">.</span><span class="n">Exchange</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">(),</span> <span class="n">code</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
	<span class="n">dropboxCfg</span> <span class="o">:=</span> <span class="n">dropbox</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
		<span class="n">Token</span><span class="o">:</span> <span class="n">token</span><span class="o">.</span><span class="n">AccessToken</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">client</span> <span class="o">:=</span> <span class="n">files</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">dropboxCfg</span><span class="p">)</span>
	<span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h1 id="認証時のロール">認証時のロール</h1> <p>ちょっと変わったところとしてはリクエストを準備する際のロールについて紹介しておこうと思います。OAuthではscopesというパラメータを使ってアプリケーションに対し、認可する範囲を設定します。Dropboxでは<a href="/2017/12/08/dropbox-api-overview/">Dropbox APIの概要</a>にてご紹介したとおり、アプリケーション登録時にアクセス権限を設定します。</p> <p>このため、scopesパラメータを使わない場合も多いのですが一つだけ指定できるものがあります。</p> <p>Dropboxでは個人向けDropbox (Dropbox Basic、Plus、Professional)アカウントと、Dropbox Businessアカウントを<a href="https://www.dropbox.com/help/business/connect-personal-work-account">リンクすることでパソコン、スマートフォン、タブレットなどのアプリケーションで同時に二つのアカウントを利用できる機能</a>があります。</p> <p>このときに、アプリケーションの接続を会社のアカウントのみに限定したいとか、逆に個人向けのみに限定したいといった指定にscopesパラメータを利用します。</p> <p>Javaの場合は<code class="language-plaintext highlighter-rouge">DbxWebAuth.Request.Builder</code>で <code class="language-plaintext highlighter-rouge">withRequireRole()</code>メソッドへ<a href="https://dropbox.github.io/dropbox-sdk-java/api-docs/v2.1.x/com/dropbox/core/DbxWebAuth.html#ROLE_PERSONAL">ROLE_PERSONAL</a>または<a href="https://dropbox.github.io/dropbox-sdk-java/api-docs/v2.1.x/com/dropbox/core/DbxWebAuth.html#ROLE_WORK">ROLE_WORK</a>を指定します。</p> <h1 id="トークンの無効化">トークンの無効化</h1> <p>一定の処理が終わって、ログアウトに相当するトークンの無効化処理をしたい場合の処理です。これは、User EndpointsとBusiness Endpointsで若干変わります。</p> <h2 id="user-endpointsの場合">User Endpointsの場合</h2> <p>User Endpointsの場合は<a href="https://www.dropbox.com/developers/documentation/http/documentation#auth-token-revoke">auth/token/revoke</a>にAccess Tokenを渡すだけです。</p> <h2 id="business-endpointsの場合">Business Endpointsの場合</h2> <p>Business Endpointsでは<code class="language-plaintext highlighter-rouge">auth/token/revoke</code>に直接相当するAPIがありません。このためチーム管理者が<a href="https://www.dropbox.com/help/business/business-api#manage">管理者コンソールよりチーム向けアプリケーションを無効化する必要があります</a>。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/12/08/dropbox-api-overview/"> Dropbox APIの概要 </a> </h1> <span class="post-date"> 8th December 2017</span> <span class="post-tags"> #<a href="/tags/api">api</a> #<a href="/tags/dropbox">dropbox</a> #<a href="/tags/dropboxapi">dropboxapi</a> </span> <p>DropboxのAPIについて説明している日本語情報が少ないようなので、個人的にメンテナンスしている<a href="https://github.com/watermint/toolbox">toolbox</a>というプロジェクトの経験をもとに説明していこうと思います。APIを網羅的に解説するよりは、勘所をつかむための解説にしようと思いますので詳細は英語版とはなりますが<a href="https://www.dropbox.com/developers">公式ドキュメント</a>をご参照ください。またOAuthやJSON、curlコマンドなどWeb APIにて一般的な概念やツールなどについては説明を省略します。</p> <p>なお、本記事は個人の見解であり、執筆時点での情報を元としています。記事の正確性などについて保証するものではない点ご容赦ください。最新情報については<a href="https://www.dropbox.com/developers">公式ドキュメント</a>をご参照ください。</p> <p>前置きが長くなりましたが今回は概要です。</p> <hr/> <h1 id="dropbox-apiの種類">Dropbox APIの種類</h1> <p>Dropboxより提供されているAPIには大きく分けて下記二種類があります。</p> <ul> <li>Dropbox API または User Endpoints … ユーザー毎のファイル管理など</li> <li>Dropbox Business API または Business Endpoints … Dropbox Businessチームの管理</li> </ul> <p>なおドキュメントによって文脈によって単に「Dropbox API」とだけいったときに両方を含む場合もあれば、ユーザー毎のファイル管理だけを指す場合もあります。一部厳密性に欠ける部分もありますが、本記事では両方を指す場合にDropbox API、個別に種類を言い分けるためにはUser EndpointsとBusiness Endpointsという呼称を使うことにします。</p> <h1 id="api-explorer">API Explorer</h1> <p>ドキュメントを読み込むなどある程度準備してから取りかかるのもいいですが、まずは簡単に試してみるのが手っ取り早いでしょう。<a href="https://dropbox.github.io/dropbox-api-v2-explorer/">API Explorer</a>というツールが公開されていますのでこちらを利用します。</p> <p><img src="/images/2017-12-08-api-explorer.jpg" alt="API Explorer"/></p> <p>左側にAPI一覧があり、APIを選択すると指定できるパラメータなどがフォームとして表示されます。わかりづらいですが、右上に「Switch to Business Endpoints」というリンクがありますのでBusiness Endpointsについても試すことができます。</p> <p>ためしにフォルダ内のファイル一覧を表示してみましょう。APIはカテゴリ毎にパスが区切られていて、ファイル操作であれば <code class="language-plaintext highlighter-rouge">https://api.dropboxapi.com/2/files/</code> 以下のエンドポイントが該当します。 この中の、<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-list_folder">list_folder</a>というAPIがファイル一覧取得のためのAPIです。API Explorerではこのカテゴリ毎に整理されていますのでfiles以下からlist_folderを探してみてください。</p> <p><img src="/images/2017-12-08-list_folder.jpg" alt="list_folder"/></p> <p>まずは認証から。<code class="language-plaintext highlighter-rouge">Get Token</code>というボタンがあるのでこれを押してトークンを取得します。Dropboxへのログインや認可の確認などが求められますがそれらを確認のうえトークン文字列を取得してください。</p> <p>早速実行してみましょう。Submit Callボタンを押します。パラメータ<code class="language-plaintext highlighter-rouge">path</code>に何も入れなければDropboxフォルダのルートからの一覧になります。逆に、ルートフォルダを一覧するために <code class="language-plaintext highlighter-rouge">/</code> は使えません。Show Codeボタンを押せば<code class="language-plaintext highlighter-rouge">curl</code>での実行例も表示されます。戻り値については<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-list_folder">list_folder</a> APIドキュメントに記載がありますが、正常ケース・異常ケースともに結果がJSON形式で返されます。</p> <h1 id="アプリケーションの登録">アプリケーションの登録</h1> <p>Dropbox APIを使って開発を進めるにはまずDropboxへアプリケーションの登録が必要となります。登録のためにはDropboxアカウントが必要となります。Dropbox開発者ページの<a href="https://www.dropbox.com/developers/apps">My apps</a>から登録します。</p> <p><img src="/images/2017-12-08-newapp.jpg" alt="Create App"/></p> <p>APIの種別、アクセス範囲などを選択した上でアプリケーション名を登録します。アプリケーション名はDropboxサービス全体で一意になる必要があり重複した名称をつけることはできません。開発したいアプリケーションで複数のアクセス範囲を使いたい場合にはそれらアクセス範囲ごとにアプリケーションの登録が必要となるので、命名規則なども準備したうえで登録するとスムーズです。</p> <p>アクセス範囲についての詳細は次の通りです。</p> <h2 id="user-endpoints">User Endpoints</h2> <h3 id="app-folder">App Folder</h3> <p>アクセス範囲をアプリケーションのみが使用するフォルダに限定します。Dropboxフォルダ以下に「アプリ」またはユーザーの利用設定言語が英語などであれば「Apps」などのフォルダが作成され、このアプリフォルダ以下に<code class="language-plaintext highlighter-rouge">/アプリ/アプリ名</code>のようなフォルダが作成されます。App Folderを選択するとこのフォルダ以下しか操作することができません。</p> <h3 id="full-dropbox">Full Dropbox</h3> <p>該当アカウントのすべてのファイルを操作できます。</p> <h2 id="business-endpoints">Business Endpoints</h2> <p>Dropbox Business向けのAPIはチーム内のアカウント管理や監査ログを取得するなど目的に応じて範囲が分けられています。</p> <h3 id="team-information">Team information</h3> <p>チームに関する情報と利用統計情報などにアクセスできます。情報を取得するだけ管理など変更処理はできません。</p> <h3 id="team-auditing">Team auditing</h3> <p>Team informationの範囲に加え、チーム監査のために利用します。<a href="https://www.dropbox.com/help/business/activity-audit">アクティビティ監査ログ</a>のような情報にアクセスすることができます。</p> <h3 id="team-member-file-access">Team member file access</h3> <p>Team informationならびにTeam auditingに加え、任意のチーム内アカウントへのファイル操作などアクションを実行することができます。たとえば、チーム内のアカウントすべての共有フォルダの共有先一覧を取得したいといった場合にはこのアクセス範囲を利用します。</p> <h3 id="team-member-management">Team member management</h3> <p>Team informationに加え、チーム管理者としての操作をするためのアクセス範囲です。チームメンバーを招待したり、アカウントの情報編集、削除などといった管理操作が可能です。たとえば、社内ワークフローと組み合わせて社内ワークフローで承認された人だけにDropbox Businessアカウントを招待するという用途にはこのアクセス範囲を利用します。</p> <h1 id="アプリケーションの設定">アプリケーションの設定</h1> <p>アプリケーションを登録すると設定画面が表示されます。OAuth2のGenerated access tokenという欄にGenerateというボタンがあります。これを押すと、既存のログイン済みアカウントで認可済みのトークンが生成されます。テストなどで利用すると良いでしょう。ちゃんとしたOAuth2シーケンスでトークンを取得する場合に必要となるApp key/secretについてもこの画面から参照することができます。</p> <p><img src="/images/2017-12-08-app-config.jpg" alt="App settings"/></p> <p>なおBusiness Endpoints向けのアプリケーションではこの操作を行うのは、そのチームのチーム管理者である必要があります。</p> <h1 id="dropbox-sdk">Dropbox SDK</h1> <p>API Explorerで勘所がつかめ、アプリケーション設定が終わったらプログラミング開始です。REST APIなのでパラメータや戻り値を加工すれば何とでも呼び出しはできますが、やはりあらかじめ構造体/クラスなどが定義されたSDKを使った方が手軽です。</p> <p><a href="https://www.dropbox.com/developers/documentation">Choose your platform</a>ドキュメントを参照すると代表的なプログラミング言語用の公式SDKが一覧されています。執筆時点での対応言語は下記の通り。</p> <ul> <li><a href="https://www.dropbox.com/developers/documentation/swift">Swift</a></li> <li><a href="https://www.dropbox.com/developers/documentation/objective-c">Objective-C</a></li> <li><a href="https://www.dropbox.com/developers/documentation/python">Python</a></li> <li><a href="https://www.dropbox.com/developers/documentation/dotnet">.NET</a></li> <li><a href="https://www.dropbox.com/developers/documentation/java">Java</a></li> <li><a href="https://www.dropbox.com/developers/documentation/javascript">JavaScript</a></li> </ul> <p>GoやRuby向けなどこのなかにない場合には<a href="https://www.dropbox.com/developers/documentation/communitysdks">コミュニティにてメンテナンスされているSDK</a>も利用できます。</p> <p>さらにコミュニティSDKもない場合、たとえばPowerShellで簡単な管理ツールを作りたいというようにこの中で対応言語がない場合には<a href="https://www.dropbox.com/developers/documentation/http/overview">HTTP</a>のAPIドキュメントを参照しながら作成していくことになります。</p> <h2 id="sdkの選び方">SDKの選び方</h2> <p>APIはバージョン毎に互換性が保たれるよう提供されていますが、比較的頻繁に新しいAPIやパラメータ、戻り値が追加されるのでこれらに追従することを考えると公式SDKを採用した方がやや有利です。</p> <p>Dropbox公式SDKは<a href="https://github.com/dropbox/stone">stone</a>というツールを使って自動生成されるようになっていますから、こういった変化への追従に強い点が特徴です。</p> <p>一方で、お作法が統一されていて言語毎に特化した書き方ではないのでややなじみにくく感じる部分もあるかもしれません。</p> <p>ファイルをアップロードするだけ、とかダウンロードするだけといった用途が一定または特化している場合にはコミュニティSDKのほうがなじみやすいかもしれません。</p> <h1 id="dropbox-apiの使い処">Dropbox APIの使い処</h1> <p>Dropbox上でできる主要操作はだいたいDropbox APIを利用すれば実現できます。また逆に、APIでなければ実現できないものもあります。少し実例を元に紹介していきましょう。</p> <h2 id="共有リンクのパスワード有効期限を一括設定する">共有リンクのパスワード/有効期限を一括設定する</h2> <p>Dropbox ProfessionalやDropbox Business契約があるばあいには、<a href="https://www.dropbox.com/help/files-folders/link-expiration">共有リンクへパスワードや有効期限を設定することができます</a>。ただ、共有リンク一つ一つに画面から設定するのは面倒なので一括設定したいと考えることもあります。こういったときにDropbox APIを利用すると実現できます。</p> <p>たとえば拙作<a href="https://github.com/watermint/toolbox/releases/tag/22.20171004.2">toolbox</a>ではこの操作を実装しました。</p> <p>Business Endpointsのアクセス権「Team member file access」を使い、すべてのユーザーについて共有リンク一覧を取得します。</p> <p>すべてのユーザーに対して処理を行うにはまず<a href="https://www.dropbox.com/developers/documentation/http/teams#team-members-list">teams/members/list</a>でアカウント一覧を取得します。各ユーザーについて<a href="https://www.dropbox.com/developers/documentation/http/documentation#sharing-list_shared_links">sharing/list_shared_links</a> APIでリンクを取得するのですがこのときに、<a href="https://www.dropbox.com/developers/documentation/http/teams#teams-member-file-access">Member file access</a>にあるとおり、HTTPヘッダに<code class="language-plaintext highlighter-rouge">Dropbox-API-Select-User: チームメンバーID</code>を追加すると、その該当アカウントとして処理が行われます。</p> <p>共有リンクが取得できたら、同様に<code class="language-plaintext highlighter-rouge">Dropbox-API-Select-User: チームメンバーID</code>を使って、各ユーザーそれぞれの共有リンクについて<a href="https://www.dropbox.com/developers/documentation/http/documentation#sharing-modify_shared_link_settings">sharing/modify_shared_link_settings</a>を使って有効期限を今日から7日後などに上書きします。</p> <h2 id="共有フォルダへの参加者一覧">共有フォルダへの参加者一覧</h2> <p>監査などの目的でDropbox Businessチーム内の各利用者が参加している共有フォルダの参加者一覧を取得したい場合があるとします。 これも以前Pythonで実装したことがあります。</p> <ul> <li><a href="https://github.com/dropbox/DropboxBusinessScripts/blob/master/Sharing/ListSharedFolderMembers.py">ListSharedFolderMembers.py</a></li> </ul> <p>Business Endpointsのアクセス権「Team member file access」を使い、すべてのユーザーについて処理を行います。 共有フォルダの場合にはアクセス権限がメンバー単位だけでなくグループ単位の場合もあるのでグループ情報を取得するために<a href="https://www.dropbox.com/developers/documentation/http/teams#team-groups-list">teams/groups/list</a>なども使っています。</p> <h2 id="大量ファイルのコピー移動削除など">大量ファイルのコピー/移動/削除など</h2> <p>Web画面から操作する際にファイルが一定数を超えていると処理ができない旨が表示されます。Dropboxアプリケーション実行すれば大量ファイルでも処理はできるのですが、パソコン上に同期していない場合などでは処理ができないのと、パソコンにやや負荷もかかります。</p> <p>このためそれぞれのファイルを逐次コピーないし、移動するようにUser EndpointsのAPIを使えば着実に処理を進めることができます。コピーであれば<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-copy_v2">files/copy_v2</a>、移動であれば<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-move_v2">files/move_v2</a>といったAPIを使います。</p> <p>なおAPIを使った場合でもAPIドキュメントにあるとおり10,000ファイル以上を同時に処理することはできません。</p> <blockquote> <p>too_many_files The operation would involve more than 10,000 files and folders.</p> </blockquote> <p>小分けにして処理する必要があります。</p> <h2 id="ログイン済みデバイス一覧や強制ログアウト">ログイン済みデバイス一覧や強制ログアウト</h2> <p>Business Endpointsの<a href="https://www.dropbox.com/developers/documentation/http/teams#team-devices-list_members_devices">team/devices/list_member_devices</a> APIを使うとDropbox Businessチーム内のデスクトップ、モバイル、Webとそれぞれのセッション一覧を取得することができます。セッション情報には最終接続IPアドレスやUser Agentなども含まれるので、一定のルールを元に強制ログアウトを実施すると行った使い方もできます。たとえば、社内IP以外が検出されたら強制ログアウトなど。</p> <p>強制ログアウトのためには<a href="https://www.dropbox.com/developers/documentation/http/teams#team-devices-revoke_device_session">team/devices/revoke_device_session</a> APIを使います。</p> <h1 id="まとめ">まとめ</h1> <p>Dropbox APIを使うと社内ワークフローと連携して自動処理を行ったり、運用ポリシーなどに合わせて管理する、あるいはDevOpsのように開発ワークフローと組み合わせて、Dropboxの特定フォルダにファイルがアップロードされたらビルド開始。といったことも実現可能です。</p> <p>お作法はあるていどあるものの、一度覚えてしまえばやりたいことが簡潔に書けるようなAPIがそろっているかなと思います。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/11/07/travel-small-articles/"> 旅行の小物整理 </a> </h1> <span class="post-date"> 7th November 2017</span> <span class="post-tags"> #<a href="/tags/smallarticle">smallarticle</a> #<a href="/tags/travel">travel</a> </span> <p>海外旅行や海外出張に行く際、小物整理は意外とやっかいでした。今回はそういった海外旅行の際の小物整理で工夫していることをまとめます。旅行時の小物と行っても様々です。今回は次のように主に小さく薄っぺらいものをまとめて整理する方法について。</p> <ul> <li>パスポートや航空券など大事な書類</li> <li>入国時の申請書類など</li> <li>予備のクレジットカードやキャッシュカード</li> <li>現地で受け取ったレシート (家計簿や経費精算などのために整理したい)</li> <li>現地でもらったレストランなどのショップカード、観光地のパンフレット</li> <li>現地で利用するSIMカードまたは、交換した日本のSIMカード</li> </ul> <p>これまで数年は<a href="http://amzn.to/2iBOpXq">BRUNOのトラベルオーガナイザー</a>を使っていました。パスポートや航空券、カード類が整理できるようになっていてとても便利です。それ以前は手帳に挟んだり、鞄のポケットにいれたり統一感無く管理していたので、入国管理や税関などで書類を提出する際もあたふたしていました。このトラベルオーガナイザーを使って整理したことで入出国時のストレスが少し解消されました。</p> <p><img src="/images/2017-11-07-travel1.jpg" alt="トラベルオーガナイザー"/></p> <p>革製でかっこよく、丈夫なので航空券が折れ曲がったりもせず気に入って使っていました。ただ、ここ数回の旅行では今までよりも小さな鞄を持って旅行していたのでこのわずかな厚みも気になるようになってしまいました。また、旅行先で受け取ったレシートなどもトラベルオーガナイザーに入れてしまうとかなり分厚くなってしまいます。 鞄には出張時であればノートパソコン(15インチのMacBook Pro)、iPad、携帯電話、それぞれの充電器(乗り継ぎ待ちの際利用)を入れていてこれだけでほぼ鞄がいっぱいに。この結果、トラベルオーガナイザーも出し入れがやや窮屈に。</p> <p>また旅行券も以前はほとんどの場合、磁気ストライプのあるハガキぐらいのやや厚手な紙が使われていました。これが最近、バーコードを読み取るだけにかわり薄っぺらい感熱紙のような紙が使われる場合も増えてきました。あまり薄っぺらいと、トラベルオーガナイザーの収納ポケットの形によっては整理する際にやや手間取ります。</p> <p>そこで直近の海外出張では<a href="http://amzn.to/2Ao4HLj">B6サイズのメッシュケース</a>を使い始めました。よく銀行の通帳やキャッシュカードをひとまとめに整理するために使ったりするケースです。</p> <p><img src="/images/2017-11-07-travel2.jpg" alt="メッシュケース"/></p> <p>なかなか丈夫で信頼性のあるケースで、何より価格も手ごろです。B6サイズのメッシュケースは210mm x 170mmとA5サイズがきっちり入るサイズです。このシリーズではマチの部分も考慮して一回り小さめの呼称をしているのだと思います。 あまり気にしていませんでしたが、最近乗ったJALやBritish Airwaysの航空券のサイズは20cmちょっと x 8cmちょっとでぴったり入りました。</p> <p>このセキセイのメッシュケースはチャック部分が色違いの赤と青のものがあります。この2種類を目的別に使い分けることにしました。 一つ目はチャックが赤色のもので重要なものを入れます。これから利用する航空券やパスポート、SIMカードなど。 二つ目はチャックが青色のものであまり重要ではないものを入れます。レシートや地図など。</p> <p>このように整理すれば入出国時にもバタバタしませんし、もともと薄手なのでかさばりません。重要ではない青色チャックのメッシュケースがもし手荷物に入らなければ、預け荷物に入れることもできます。</p> <p>うまくいったので、2種類だけではなく、目的別にもう少し種類を増やしてみようかとも考えましたがあまり多すぎるとまたそれはそれでゴチャゴチャしてしまうのでせいぜい2種類ぐらいが良さそうです。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/09/28/unihertz-jelly/"> Unihertz Jellyレビュー </a> </h1> <span class="post-date"> 28th September 2017</span> <span class="post-tags"> #<a href="/tags/android">android</a> #<a href="/tags/jelly">jelly</a> #<a href="/tags/travel">travel</a> </span> <p><a href="https://www.kickstarter.com/projects/jellyphone/jelly-the-smallest-4g-smartphone">The Smallest 4G Smartphone</a>と、世界最小を謳う4GスマートフォンJelly。Kickstarterにて目標額を達成し、正式に発売されることになりました。今月上旬に手に入れることができたので少しレビューをしてみたいと思います。仕様などについてはKickstarterサイトや他のレビューなどが詳しいので、使用感を中心にレビューしたいと思います。</p> <p>メモリー容量の違うJellyとJelly Proという2モデルがあり、メモリー容量が小さいJellyのほうは発売前に廃盤となってしまったのでKickstarter限定となってしまいました。今回購入したのはメモリー容量の小さいJellyのほうです。</p> <p>なお残念ながら現状、技適を取得していないため日本では電波を発することができません。海外旅行時のバックアップ用として購入しましたが、ちょうど今月海外へ行く機会があったので実際に使ってきました。SIMは<a href="https://www.mtxc.eu/">MTXC</a>のものを準備しています。1GB、15日間で約20ユーロです。</p> <p><img src="/images/2017-09-16-jelly.jpg" alt="利用の様子"/></p> <p>今回はヘルシンキ、ダブリン、ロンドンで使ってきました。世界最小を謳うだけあり、確かに小さい。まだ現役で使っているiPhone 5sよりもずっと小さい。画面も2.45インチでキーボード入力などもかなり難しく、バリバリ使う。というよりは、補助的な利用方法がメインになるかと思います。</p> <p>Google Mapで地図を確認するにも小さすぎ、実用上は大雑把に把握する程度に考えておいた方が良さそうです。一方で、Turn-by-turnナビゲーション機能を使った場合はそれなりに視認性もよいので、このスマートフォンで一番しっくり来るように思いました。画面をずっとにらめっこするタイプではなく、信号待ちのときなどに方向を確認するぐらいの使い方が合っているのでしょう。</p> <p>街歩きで使ってみたところ、デジタルコンパスがなかなかうまく正しい方向を向いてくれません。しばらく歩いていると方向があってくるので、街の風景を楽しみつつときどき方向を確認するぐらいでいいのだと思います。</p> <p>バッテリーがどの程度持つかは気になるところでしたが、全くゼロになることはありませんでした。ただGoogle Mapなどそれなりに使っていると丸一日は持たないかなというぐらいの印象で、やはりバリバリいろいろ調べながら街歩きをするためのスマートフォンではありません。周りの風景を楽しみながら適当に散策し、迷子になったり時間の余裕がなくなってきたときの最終手段としてポケットに忍ばせておくぐらいのつもりで使っていると便利でしょう。</p> <p>予備バッテリーを持ち歩くという手段もありますが、バッテリーを持ち歩くぐらいだったら、iPhone 5sのほうがバッテリーの持ち、サイズ感など考えた場合により使いやすいと思います。電波の入り方はヘルシンキ、ダブリン、ロンドンのいずれでも特に不満はなくGoogle Mapも普通に利用できました。</p> <p>総評:</p> <p>知らない街をあるくときの安心材料としてポケットに入れておくぐらいの使い方が良さそうです。レビューを見ながらレストランを探したり、写真を撮ってSNSにアップロードするような使い方は向いていません。ぶらり入ったレストランがたまたま美味しかったり、適当に歩いた先にあった公園がきれいだったりするのを楽しみながら旅するためのスマートフォンです。</p> </div> </div> <div class="pagination"> <a class="pagination-item older" href="/page7">Older</a> <a class="pagination-item newer" href="/page5">Newer</a> </div> </div> <div class="container copyright"> &copy; 2007, 2013-2022 Takayuki Okazaki </div> </div> <label for="sidebar-checkbox" class="sidebar-toggle"></label> <script>!function(e){var r=e.querySelector(".sidebar-toggle"),t=e.querySelector("#sidebar"),n=e.querySelector("#sidebar-checkbox");e.addEventListener("click",function(e){var c=e.target;n.checked&&!t.contains(c)&&c!==n&&c!==r&&(n.checked=!1)},!1)}(document);</script> </body> </html>