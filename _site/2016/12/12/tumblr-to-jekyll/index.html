<!DOCTYPE html> <html> <head> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> TumblrからJekyll + Github Pagesへ &middot; watermint.org </title> <link rel="stylesheet" href="/public/watermint.css"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/watermint-logo.png"> <link rel="shortcut icon" href="/public/watermint-logo.png"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> </head> <body class="theme-base-09"> <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"> <div class="sidebar" id="sidebar"> <div class="sidebar-item"> <p>Travel, camera, photo, and technical things. I work at Dropbox. Thoughts are my own.</p> </div> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Home</a> <a class="sidebar-nav-item" href="/about/">About</a> <a class="sidebar-nav-item" href="/atom.xml">Feed</a> <a class="sidebar-nav-item" href="https://github.com/watermint">Github</a> <a class="sidebar-nav-item" href="https://www.instagram.com/watermint/">Instagram</a> </nav> <div class="sidebar-item"> <p> &copy; 2005-2017 Takayuki Okazaki </p> </div> </div> <div class="wrap"> <div class="masthead"> <div class="container"> <h3 class="masthead-title"> <a href="/" title="Home">watermint.org</a> <small>- Takayuki Okazaki's note</small> </h3> </div> </div> <div class="container content"> <div class="post"> <h1 class="post-title">TumblrからJekyll + Github Pagesへ</h1> <span class="post-date"> 12th December 2016</span> <p><a href="/2013/08/24/wordpress-to-tumblr">3年ほど前にWordPressからTumblrへ移行しました</a>。特に大きな問題があったわけではないのですが、最近ソースコードを挿入した記事をいくつか書こうとしたところTumblrのMarkdownではうまく表現され切れない点にすこしストレスを感じていました。表示をあれこれいじっている時間ももったいなくなってきたのでいっそのこと、<a href="https://guides.github.com/features/mastering-markdown/#GitHub-flavored-markdown">GFM (GitHub Flavored Markdown)</a>で書けるようなサービスか、システムに移行しようと考え始めました。</p> <p>あれこれ調べているうちに、どうやら<a href="https://jekyllrb.com/">Jekyll</a>をつかって<a href="https://pages.github.com/">Github Pages</a>へ移行するのがスムーズそうだなと調べ始めて評価し、次の点で問題なさそうだったので移行することにしました。</p> <ul> <li>GFMで書ける</li> <li>既存のURL構成を引き継げる</li> <li>Tumblrからの記事取り込みもできる</li> <li>シンプルなテーマがある</li> </ul> <p>逆に移行に当たってできなくなる機能もあります。たとえばソーシャルメディア連携です。Tumblrでホストしてもらえば、Tumblr上のソーシャルメディアでリブログなど拡散手段があります。ほかには予約投稿やTwitter連携といった機能も使えなくなります。このあたりはトレードオフですが、ソーシャルメディアで拡散していただくよりも、そもそも記事が書きづらくて筆無精になるのであれば優先順位は明らかです。</p> <p>ソーシャルメディア連携もあとからIFTTTなど何か使えば実現できるでしょうし、予約投稿も必要になれば決まった時間に<code class="highlighter-rouge">git push</code>するよう何か構成を考えればいいだけです。</p> <h1 id="section">移行の効果</h1> <p>移行中のあれこれは後述することにしてまずは、移行によってどういったメリットがあったかみてみます。</p> <p>WordPressから移行した際にはサイトの速度が劇的に改善しましたが、今回は比較的軽微な差に収まっています。</p> <h2 id="tumblrpagespeed">TumblrでのPageSpeed結果</h2> <p>まずはTumblrでの<a href="https://developers.google.com/speed/pagespeed/">PageSpeed</a>計測結果から。</p> <p><img src="/images/2016-12-12-tumblr-mobile.png" alt="Tumblr / モバイル"/></p> <p>モバイル用のスコアは67点。画像サイズが大きいと警告がでているのと、キャッシュ設定などのところで最適化の余地があるとの判定です。</p> <p><img src="/images/2016-12-12-tumblr-desktop.png" alt="Tumblr / デスクトップ"/></p> <p>デスクトップ用のスコアは77点。モバイルと同様に画像が大きいと警告が出ています。いずれにしても体感的にはもっさりした感覚は全くなく、表示速度などの不満は特にありませんでした。</p> <h2 id="jekyll--github-pagespagespeed">Jekyll + Github PagesでPageSpeed結果</h2> <p><img src="/images/2016-12-12-jekyll-mobile.png" alt="Jekyll + Github Pages / モバイル"/></p> <p>モバイル用のスコアは72点と少しだけTumblrでの表示より改善しています。これはTumblrのインフラスピードとの差というよりは、採用しているテーマのCSSやJavaScriptの差がほとんどだと考えられます。</p> <p><img src="/images/2016-12-12-jekyll-desktop.png" alt="Jekyll + Github Pages / デスクトップ"/></p> <p>デスクトップ用のスコアは77点とTumblrでの結果と同じです。</p> <h2 id="section-1">その他の違い</h2> <p>Tumblrではモバイル対応していないテーマを使っていたので、TumblrのUIが優先して表示されています。一方、Jekyllで今回利用した<a href="http://lanyon.getpoole.com/">Lanyon</a>はモバイルフレンドリーなテーマで、今回どちらでも同じLook and Feelでサイトを表示できるようになりました。</p> <h1 id="section-2">移行</h1> <p>移行作業はJekyllの使い方を覚えるところから全部でおおよそ5〜6時間かかったかと思います。Jekyllはかなり活発に開発されているようなのであまりここで細々と手順を書いてもすぐ使いもにならなくなってしまう気がするのでおおまかな流れだけご紹介しておきます。</p> <h2 id="jekyll">Jekyll環境の設定</h2> <p>最近はこの手のツールを使うときはすべてDockerを使って独立した環境で実行するようにしています。再現性もありますし、手元の環境もシンプルに保てます。Jekyllを使うには既存のDockerイメージを使えば充分ですが、いくつかテーマを試したりしているうちに依存関係のあるライブラリをまとめてイメージとして持っていたほうが便利だったので次のような内容の<code class="highlighter-rouge">Dockerfile</code>を作っています。</p> <div class="highlighter-rouge"><pre class="highlight"><code>FROM jekyll/jekyll:builder

RUN apk add --no-cache --virtual build-dependencies build-base
RUN apk add --no-cache libxml2-dev libxslt-dev
RUN apk add --no-cache ruby-dev curl-dev zlib-dev yaml-dev
RUN gem install nokogiri
RUN gem install minima
RUN gem install jekyll-import
</code></pre> </div> <p><code class="highlighter-rouge">jekyll-import</code>は後述のTumblrから記事を取り込んだときに使ったものです。この<code class="highlighter-rouge">Dockerfile</code>をビルドしておきます。たとえば<code class="highlighter-rouge">site</code>ディレクトリ以下につくっていくならこんな感じにコンテナを実行して、テンプレートを作ったり<code class="highlighter-rouge">jekyll-import</code>を実行したりできます。</p> <div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>docker run --rm -i <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/site:/srv/jekyll -p 4000:4000 -t <span class="o">(</span>ビルドしたときのタグ名<span class="o">)</span> bash
</code></pre> </div> <p>今回はあれこれテーマをダウンロードし、<code class="highlighter-rouge">jekyll-import</code>でTumblrから記事をざっくり取り込んで表示確認をしながらレイアウトを決定しました。</p> <h2 id="tumblr">Tumblrからのインポート</h2> <p><a href="http://import.jekyllrb.com/docs/tumblr/">jekyll-importのTumblrについての記事</a>にコマンドが書かれていますのでこれを実行します。 移行といっても今回はTumblrで書いた記事が12記事しかなかったので、ある程度の部分は詳しく調べずに手作業でファイルを修正していくというスタイルで解決しました。</p> <p>今回実行した際は次のように実行しました。</p> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>ruby -rubygems -e <span class="s1">'require "jekyll-import";
    JekyllImport::Importers::Tumblr.run({
      "url"            =&gt; "http://(TumblrのID).tumblr.com",
      "format"         =&gt; "html",
      "grab_images"    =&gt; true,
      "add_highlights" =&gt; true,
      "rewrite_urls"   =&gt; true
    })'</span>
</code></pre> </div> <p>最初formatはMarkdown(md)を指定していましたが、うまく記事が取りこめなかったのでhtmlで取り込み、あとで手動でMarkdownに変換しました。</p> <p>Tumblrでは記事のURLが <code class="highlighter-rouge">/post/(記事ID)/(記事タイトル)</code>というフォーマットでしたが、Jekyllでは<code class="highlighter-rouge">/(年)/(月)/(日)/(記事タイトル)</code>となるので変換が必要です。<code class="highlighter-rouge">rewrite_urls</code>で相当するアドレスにリダイレクトするファイルを作ってくれるので、リンクはそのまま維持できます。</p> <p>ただ困ったことに生々されたリダイレクト用の<code class="highlighter-rouge">index.html</code>では<code class="highlighter-rouge">/(年)-(月)-(日)-(記事タイトル)</code>へのリダイレクトになっていてうまく動きません。あれこれ探すのも面倒だったのでここは手動で直してしまいました。</p> <p><code class="highlighter-rouge">grab_images</code>という設定があり画像をもってきてくれそうな印象がありましたが、これもうまく動かなかったので手作業で画像をもってきたり、手元に保存してあったものを使ったりして再構成しました。</p> <h2 id="section-3">テーマ選び</h2> <p>いくつかサンプルを見ながら選びましたがシンプルなものがよかったのでLanyonにしました。ほかにもシンプルなデザインのものはありましたが、Lanyonは欲しい機能がおおむね入っていることと、CSSやJavaScriptを含めても全体の構成がシンプルで全体が見渡しやすいことが気に入りました。</p> <h1 id="section-4">切り替え</h1> <p>できあがったJekyllのページ一式をGithub Pagesへプッシュし、あとはCloudFlareでDNSの切り替えをすれば終了です。</p> <p>Jekyllも開発スピードが速そうなので、開発についていくとしたらかなり大変そうです。ただでき上がったサイトはかなりシンプルなHTML、CSS、JavaScriptと画像ファイルだけで構成されているのでセキュリティー上の理由などで更新しなければいけないケースはかなり少ないと思います。</p> <p>そういった意味では、一度環境ができ上がってしまえばTumblrでプレビューにあれこれ悩みながら記事を書くよりも手元の環境で確実なプレビューを見てから公開できるワークフローをつくったほうがより生産性が高そうだということで今は満足しています。</p> <p>画像を含めたオーサリングのワークフローをつくったり、プレビューから予定投稿などまでいろいろ作り込みたいところですがそのあたりはまた今度じっくり作り込んでみることにします。</p> </div> <div class="related"> <h2>Related Posts</h2> <ul class="related-posts"> <li> <a href="/2016/12/31/digital-filing/"> デジタルファイリング - データの整理整頓 <small>- 31st December 2016</small> </a> </li> <li> <a href="/2016/12/15/go-bandwidth-limit-for-multilpe-io/"> Go: 複数のReader/Writerに対する帯域幅制御 <small>- 15th December 2016</small> </a> </li> <li> <a href="/2016/12/14/dmg-and-cli-en/"> Disk image file (.dmg) from command line <small>- 14th December 2016</small> </a> </li> </ul> </div> </div> <div class="container copyright"> &copy; 2005-2017 Takayuki Okazaki </div> </div> <label for="sidebar-checkbox" class="sidebar-toggle"></label> <script>!function(e){var c=e.querySelector(".sidebar-toggle"),r=e.querySelector("#sidebar"),t=e.querySelector("#sidebar-checkbox");e.addEventListener("click",function(e){var n=e.target;t.checked&&!r.contains(n)&&n!==t&&n!==c&&(t.checked=!1)},!1)}(document);</script> <script>!function(e,t,a,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=t.createElement(a),o=t.getElementsByTagName(a)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-769616-6","auto"),ga("send","pageview");</script> </body> </html>