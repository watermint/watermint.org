<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> watermint.org &middot; Takayuki Okazaki's note </title> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/watermint-logo.png"> <link rel="shortcut icon" href="/public/watermint-logo.png"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <style>*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:serif;font-size:14px;line-height:1.8}@media(min-width:38em){html{font-size:20px}}body{color:#515151;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#268bd2;text-decoration:none}a strong{color:inherit}a:hover,a:focus{text-decoration:underline}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:bold;line-height:1.25;color:#313131;text-rendering:optimizeLegibility}h1{font-size:1.5rem;margin-top:1.6rem;margin-bottom:1.6rem}h2{margin-top:1.6rem;font-size:1.3rem}h3{margin-top:1.6rem;font-size:1.2rem}h4,h5,h6{margin-top:1rem;font-size:1rem}p{margin-top:0;margin-bottom:1rem}strong{color:#303030}ul,ol,dl{margin-top:0;margin-bottom:1rem}dt{font-weight:bold}dd{margin-bottom:.5rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee;border-bottom:1px solid #fff}abbr{font-size:85%;font-weight:bold;color:#555;text-transform:uppercase}abbr[title]{cursor:help;border-bottom:1px dotted #e5e5e5}code,pre{font-family:Menlo,Monaco,"Courier New",monospace}code{padding:.25em .5em;font-size:85%;color:#bf616a;background-color:#f9f9f9;border-radius:3px}pre{display:block;margin-top:0;margin-bottom:1rem;padding:1rem;font-size:.8rem;line-height:1.4;white-space:pre;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background-color:#f9f9f9}pre code{padding:0;font-size:100%;color:inherit;background-color:transparent}.highlight{margin-bottom:1rem;border-radius:4px}.highlight pre{margin-bottom:0}.gist .gist-file{font-family:Menlo,Monaco,"Courier New",monospace!important}.gist .markdown-body{padding:15px}.gist pre{padding:0;background-color:transparent}.gist .gist-file .gist-data{font-size:.8rem!important;line-height:1.4}.gist code{padding:0;color:inherit;background-color:transparent;border-radius:0}blockquote{padding:.5rem 1rem;margin:.8rem 0;color:#7a7a7a;border-left:.25rem solid #e5e5e5}blockquote p:last-child{margin-bottom:0}@media(min-width:30em){blockquote{padding-right:5rem;padding-left:1.25rem}}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;border:1px solid #e5e5e5;border-collapse:collapse}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}.lead{font-size:1.25rem;font-weight:300}.message{margin-bottom:1rem;padding:1rem;color:#717171;background-color:#f9f9f9}.container{max-width:38rem;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:#c0c0c0;letter-spacing:0}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.post-tags{display:block;margin-top:-.5rem;margin-bottom:1rem;text-align:right}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:"PT Sans",Helvetica,Arial,sans-serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media(min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}html,body{overflow-x:hidden;line-height:1.9em}html{font-family:serif}h1,h2,h3,h4,h5,h6{font-weight:400;color:#313131}.wrap{position:relative;width:100%}.container{max-width:28rem}@media(min-width:38em){.container{max-width:32rem}}@media(min-width:56em){.container{max-width:38rem}}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem;border-bottom:1px solid #eee}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:#c0c0c0;letter-spacing:0}@media(max-width:48em){.masthead-title{text-align:center}.masthead-title small{display:none}}.sidebar{position:fixed;top:0;bottom:0;left:-14rem;width:14rem;visibility:hidden;overflow-y:auto;font-family:serif;font-size:.875rem;line-height:1.4em;color:rgba(255,255,255,.6);background-color:#202020;-webkit-transition:all .3s ease-in-out;transition:all .3s ease-in-out}
@media(min-width:30em){.sidebar{font-size:.75rem}}.sidebar a{font-weight:normal;color:#fff}.sidebar-item{padding:1rem}.sidebar-item p:last-child{margin-bottom:0}.sidebar-nav{border-bottom:1px solid rgba(255,255,255,.1)}.sidebar-nav-item{display:block;padding:.5rem 1rem;border-top:1px solid rgba(255,255,255,.1)}.sidebar-nav-item.active,a.sidebar-nav-item:hover,a.sidebar-nav-item:focus{text-decoration:none;background-color:rgba(255,255,255,.1);border-color:transparent}@media(min-width:48em){.sidebar-item{padding:1.5rem}.sidebar-nav-item{padding-left:1.5rem;padding-right:1.5rem}}.sidebar-checkbox{position:absolute;opacity:0;-webkit-user-select:none;-moz-user-select:none;user-select:none}.sidebar-toggle{position:absolute;top:.8rem;left:1rem;display:block;padding:.25rem .75rem;color:#555;border-radius:.25rem;cursor:pointer}.sidebar-toggle:before{display:inline-block;width:1rem;height:.75rem;content:"";background-image:-webkit-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:-moz-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:-ms-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%)}.sidebar-toggle:active,#sidebar-checkbox:focus ~ .sidebar-toggle,#sidebar-checkbox:checked ~ .sidebar-toggle{color:#fff}.sidebar-toggle:active:before,#sidebar-checkbox:focus ~ .sidebar-toggle:before,#sidebar-checkbox:checked ~ .sidebar-toggle:before{background-image:-webkit-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:-moz-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:-ms-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%)}@media(min-width:30.1em){.sidebar-toggle{position:fixed}}@media print{.sidebar-toggle{display:none}}.wrap,.sidebar,.sidebar-toggle{-webkit-backface-visibility:hidden;-ms-backface-visibility:hidden;backface-visibility:hidden}.wrap,.sidebar-toggle{-webkit-transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out}#sidebar-checkbox:checked+.sidebar{z-index:10;visibility:visible}#sidebar-checkbox:checked ~ .sidebar,#sidebar-checkbox:checked ~ .wrap,#sidebar-checkbox:checked ~ .sidebar-toggle{-webkit-transform:translateX(14rem);-ms-transform:translateX(14rem);transform:translateX(14rem)}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media(min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}.layout-reverse .sidebar{left:auto;right:-14rem}.layout-reverse .sidebar-toggle{left:auto;right:1rem}.layout-reverse #sidebar-checkbox:checked ~ .sidebar,.layout-reverse #sidebar-checkbox:checked ~ .wrap,.layout-reverse #sidebar-checkbox:checked ~ .sidebar-toggle{-webkit-transform:translateX(-14rem);-ms-transform:translateX(-14rem);transform:translateX(-14rem)}.theme-base-08 .sidebar,.theme-base-08 .sidebar-toggle:active,.theme-base-08 #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#ac4142}.theme-base-08 .container a,.theme-base-08 .sidebar-toggle,.theme-base-08 .related-posts li a:hover{color:#ac4142}.theme-base-09 .sidebar,.theme-base-09 .sidebar-toggle:active,.theme-base-09 #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#d28445}.theme-base-09 .container a,.theme-base-09 .sidebar-toggle,.theme-base-09 .related-posts li a:hover{color:#d28445}.theme-base-0a .sidebar,.theme-base-0a .sidebar-toggle:active,.theme-base-0a #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#f4bf75}
.theme-base-0a .container a,.theme-base-0a .sidebar-toggle,.theme-base-0a .related-posts li a:hover{color:#f4bf75}.theme-base-0b .sidebar,.theme-base-0b .sidebar-toggle:active,.theme-base-0b #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#90a959}.theme-base-0b .container a,.theme-base-0b .sidebar-toggle,.theme-base-0b .related-posts li a:hover{color:#90a959}.theme-base-0c .sidebar,.theme-base-0c .sidebar-toggle:active,.theme-base-0c #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#75b5aa}.theme-base-0c .container a,.theme-base-0c .sidebar-toggle,.theme-base-0c .related-posts li a:hover{color:#75b5aa}.theme-base-0d .sidebar,.theme-base-0d .sidebar-toggle:active,.theme-base-0d #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#6a9fb5}.theme-base-0d .container a,.theme-base-0d .sidebar-toggle,.theme-base-0d .related-posts li a:hover{color:#6a9fb5}.theme-base-0e .sidebar,.theme-base-0e .sidebar-toggle:active,.theme-base-0e #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#aa759f}.theme-base-0e .container a,.theme-base-0e .sidebar-toggle,.theme-base-0e .related-posts li a:hover{color:#aa759f}.theme-base-0f .sidebar,.theme-base-0f .sidebar-toggle:active,.theme-base-0f #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#8f5536}.theme-base-0f .container a,.theme-base-0f .sidebar-toggle,.theme-base-0f .related-posts li a:hover{color:#8f5536}.sidebar-overlay #sidebar-checkbox:checked ~ .wrap{-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0)}.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar-toggle{box-shadow:0 0 0 .25rem #fff}.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar{box-shadow:.25rem 0 .5rem rgba(0,0,0,.1)}.layout-reverse.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar{box-shadow:-.25rem 0 .5rem rgba(0,0,0,.1)}.highlight table td{padding:5px}.highlight table pre{margin:0}.highlight,.highlight .w{color:#586e75}.highlight .err{color:#002b36;background-color:#dc322f}.highlight .c,.highlight .cd,.highlight .cm,.highlight .c1,.highlight .cs{color:#657b83}.highlight .cp{color:#b58900}.highlight .nt{color:#b58900}.highlight .o,.highlight .ow{color:#93a1a1}.highlight .p,.highlight .pi{color:#93a1a1}.highlight .gi{color:#859900}.highlight .gd{color:#dc322f}.highlight .gh{color:#268bd2;background-color:#002b36;font-weight:bold}.highlight .k,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .kv{color:#6c71c4}.highlight .kc{color:#cb4b16}.highlight .kt{color:#cb4b16}.highlight .kd{color:#cb4b16}.highlight .s,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .s2,.highlight .sh,.highlight .sx,.highlight .s1{color:#859900}.highlight .sr{color:#2aa198}.highlight .si{color:#d33682}.highlight .se{color:#d33682}.highlight .nn{color:#b58900}.highlight .nc{color:#b58900}.highlight .no{color:#b58900}.highlight .na{color:#268bd2}.highlight .m,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .il,.highlight .mo,.highlight .mb,.highlight .mx{color:#859900}.highlight .ss{color:#859900}.copyright{font-size:.8em;font-style:italic;color:#555}</style> </head> <body class="theme-base-09"> <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"> <div class="sidebar" id="sidebar"> <div class="sidebar-item"> <p>Travel, camera, photo, and technical things. I work at Dropbox. Thoughts are my own.</p> </div> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Home</a> <a class="sidebar-nav-item" href="/about/">About</a> <a class="sidebar-nav-item" href="/archive/">Archive</a> <a class="sidebar-nav-item" href="/tags/">Tags</a> <a class="sidebar-nav-item" href="/atom.xml">Feed</a> <a class="sidebar-nav-item" href="https://github.com/watermint">Github</a> <a class="sidebar-nav-item" href="https://www.instagram.com/watermint/">Instagram</a> </nav> <div class="sidebar-item"> <p> &copy; 2005-2018 Takayuki Okazaki </p> </div> </div> <div class="wrap"> <div class="masthead"> <div class="container"> <h3 class="masthead-title"> <a href="/" title="Home">watermint.org</a> <small>- Takayuki Okazaki's note</small> </h3> </div> </div> <div class="container content"> <div class="posts"> <div class="post"> <h1 class="post-title"> <a href="/2017/12/08/dropbox-api-overview/"> Dropbox APIの概要 </a> </h1> <span class="post-date"> 8th December 2017</span> <span class="post-tags"> #<a href="/tags/api">api</a> #<a href="/tags/dropbox">dropbox</a> #<a href="/tags/dropboxapi">dropboxapi</a> </span> <p>DropboxのAPIについて説明している日本語情報が少ないようなので、個人的にメンテナンスしている<a href="https://github.com/watermint/toolbox">toolbox</a>というプロジェクトの経験をもとに説明していこうと思います。APIを網羅的に解説するよりは、勘所をつかむための解説にしようと思いますので詳細は英語版とはなりますが<a href="https://www.dropbox.com/developers">公式ドキュメント</a>をご参照ください。またOAuthやJSON、curlコマンドなどWeb APIにて一般的な概念やツールなどについては説明を省略します。</p> <p>なお、本記事は個人の見解であり、執筆時点での情報を元としています。記事の正確性などについて保証するものではない点ご容赦ください。最新情報については<a href="https://www.dropbox.com/developers">公式ドキュメント</a>をご参照ください。</p> <p>前置きが長くなりましたが今回は概要です。</p> <hr/> <h1 id="dropbox-apiの種類">Dropbox APIの種類</h1> <p>Dropboxより提供されているAPIには大きく分けて下記二種類があります。</p> <ul> <li>Dropbox API または User Endpoints … ユーザー毎のファイル管理など</li> <li>Dropbox Business API または Business Endpoints … Dropbox Businessチームの管理</li> </ul> <p>なおドキュメントによって文脈によって単に「Dropbox API」とだけいったときに両方を含む場合もあれば、ユーザー毎のファイル管理だけを指す場合もあります。一部厳密性に欠ける部分もありますが、本記事では両方を指す場合にDropbox API、個別に種類を言い分けるためにはUser EndpointsとBusiness Endpointsという呼称を使うことにします。</p> <h1 id="api-explorer">API Explorer</h1> <p>ドキュメントを読み込むなどある程度準備してから取りかかるのもいいですが、まずは簡単に試してみるのが手っ取り早いでしょう。<a href="https://dropbox.github.io/dropbox-api-v2-explorer/">API Explorer</a>というツールが公開されていますのでこちらを利用します。</p> <p><img src="/images/2017-12-08-api-explorer.jpg" alt="API Explorer"/></p> <p>左側にAPI一覧があり、APIを選択すると指定できるパラメータなどがフォームとして表示されます。わかりづらいですが、右上に「Switch to Business Endpoints」というリンクがありますのでBusiness Endpointsについても試すことができます。</p> <p>ためしにフォルダ内のファイル一覧を表示してみましょう。APIはカテゴリ毎にパスが区切られていて、ファイル操作であれば <code class="highlighter-rouge">https://api.dropboxapi.com/2/files/</code> 以下のエンドポイントが該当します。 この中の、<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-list_folder">list_folder</a>というAPIがファイル一覧取得のためのAPIです。API Explorerではこのカテゴリ毎に整理されていますのでfiles以下からlist_folderを探してみてください。</p> <p><img src="/images/2017-12-08-list_folder.jpg" alt="list_folder"/></p> <p>まずは認証から。<code class="highlighter-rouge">Get Token</code>というボタンがあるのでこれを押してトークンを取得します。Dropboxへのログインや認可の確認などが求められますがそれらを確認のうえトークン文字列を取得してください。</p> <p>早速実行してみましょう。Submit Callボタンを押します。パラメータ<code class="highlighter-rouge">path</code>に何も入れなければDropboxフォルダのルートからの一覧になります。逆に、ルートフォルダを一覧するために <code class="highlighter-rouge">/</code> は使えません。Show Codeボタンを押せば<code class="highlighter-rouge">curl</code>での実行例も表示されます。戻り値については<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-list_folder">list_folder</a> APIドキュメントに記載がありますが、正常ケース・異常ケースともに結果がJSON形式で返されます。</p> <h1 id="アプリケーションの登録">アプリケーションの登録</h1> <p>Dropbox APIを使って開発を進めるにはまずDropboxへアプリケーションの登録が必要となります。登録のためにはDropboxアカウントが必要となります。Dropbox開発者ページの<a href="https://www.dropbox.com/developers/apps">My apps</a>から登録します。</p> <p><img src="/images/2017-12-08-newapp.jpg" alt="Create App"/></p> <p>APIの種別、アクセス範囲などを選択した上でアプリケーション名を登録します。アプリケーション名はDropboxサービス全体で一意になる必要があり重複した名称をつけることはできません。開発したいアプリケーションで複数のアクセス範囲を使いたい場合にはそれらアクセス範囲ごとにアプリケーションの登録が必要となるので、命名規則なども準備したうえで登録するとスムーズです。</p> <p>アクセス範囲についての詳細は次の通りです。</p> <h2 id="user-endpoints">User Endpoints</h2> <h3 id="app-folder">App Folder</h3> <p>アクセス範囲をアプリケーションのみが使用するフォルダに限定します。Dropboxフォルダ以下に「アプリ」またはユーザーの利用設定言語が英語などであれば「Apps」などのフォルダが作成され、このアプリフォルダ以下に<code class="highlighter-rouge">/アプリ/アプリ名</code>のようなフォルダが作成されます。App Folderを選択するとこのフォルダ以下しか操作することができません。</p> <h3 id="full-dropbox">Full Dropbox</h3> <p>該当アカウントのすべてのファイルを操作できます。</p> <h2 id="business-endpoints">Business Endpoints</h2> <p>Dropbox Business向けのAPIはチーム内のアカウント管理や監査ログを取得するなど目的に応じて範囲が分けられています。</p> <h3 id="team-information">Team information</h3> <p>チームに関する情報と利用統計情報などにアクセスできます。情報を取得するだけ管理など変更処理はできません。</p> <h3 id="team-auditing">Team auditing</h3> <p>Team informationの範囲に加え、チーム監査のために利用します。<a href="https://www.dropbox.com/help/business/activity-audit">アクティビティ監査ログ</a>のような情報にアクセスすることができます。</p> <h3 id="team-member-file-access">Team member file access</h3> <p>Team informationならびにTeam auditingに加え、任意のチーム内アカウントへのファイル操作などアクションを実行することができます。たとえば、チーム内のアカウントすべての共有フォルダの共有先一覧を取得したいといった場合にはこのアクセス範囲を利用します。</p> <h3 id="team-member-management">Team member management</h3> <p>Team informationに加え、チーム管理者としての操作をするためのアクセス範囲です。チームメンバーを招待したり、アカウントの情報編集、削除などといった管理操作が可能です。たとえば、社内ワークフローと組み合わせて社内ワークフローで承認された人だけにDropbox Businessアカウントを招待するという用途にはこのアクセス範囲を利用します。</p> <h1 id="アプリケーションの設定">アプリケーションの設定</h1> <p>アプリケーションを登録すると設定画面が表示されます。OAuth2のGenerated access tokenという欄にGenerateというボタンがあります。これを押すと、既存のログイン済みアカウントで認可済みのトークンが生成されます。テストなどで利用すると良いでしょう。ちゃんとしたOAuth2シーケンスでトークンを取得する場合に必要となるApp key/secretについてもこの画面から参照することができます。</p> <p><img src="/images/2017-12-08-app-config.jpg" alt="App settings"/></p> <p>なおBusiness Endpoints向けのアプリケーションではこの操作を行うのは、そのチームのチーム管理者である必要があります。</p> <h1 id="dropbox-sdk">Dropbox SDK</h1> <p>API Explorerで勘所がつかめ、アプリケーション設定が終わったらプログラミング開始です。REST APIなのでパラメータや戻り値を加工すれば何とでも呼び出しはできますが、やはりあらかじめ構造体/クラスなどが定義されたSDKを使った方が手軽です。</p> <p><a href="https://www.dropbox.com/developers/documentation">Choose your platform</a>ドキュメントを参照すると代表的なプログラミング言語用の公式SDKが一覧されています。執筆時点での対応言語は下記の通り。</p> <ul> <li><a href="https://www.dropbox.com/developers/documentation/swift">Swift</a></li> <li><a href="https://www.dropbox.com/developers/documentation/objective-c">Objective-C</a></li> <li><a href="https://www.dropbox.com/developers/documentation/python">Python</a></li> <li><a href="https://www.dropbox.com/developers/documentation/dotnet">.NET</a></li> <li><a href="https://www.dropbox.com/developers/documentation/java">Java</a></li> <li><a href="https://www.dropbox.com/developers/documentation/javascript">JavaScript</a></li> </ul> <p>GoやRuby向けなどこのなかにない場合には<a href="https://www.dropbox.com/developers/documentation/communitysdks">コミュニティにてメンテナンスされているSDK</a>も利用できます。</p> <p>さらにコミュニティSDKもない場合、たとえばPowerShellで簡単な管理ツールを作りたいというようにこの中で対応言語がない場合には<a href="https://www.dropbox.com/developers/documentation/http/overview">HTTP</a>のAPIドキュメントを参照しながら作成していくことになります。</p> <h2 id="sdkの選び方">SDKの選び方</h2> <p>APIはバージョン毎に互換性が保たれるよう提供されていますが、比較的頻繁に新しいAPIやパラメータ、戻り値が追加されるのでこれらに追従することを考えると公式SDKを採用した方がやや有利です。</p> <p>Dropbox公式SDKは<a href="https://github.com/dropbox/stone">stone</a>というツールを使って自動生成されるようになっていますから、こういった変化への追従に強い点が特徴です。</p> <p>一方で、お作法が統一されていて言語毎に特化した書き方ではないのでややなじみにくく感じる部分もあるかもしれません。</p> <p>ファイルをアップロードするだけ、とかダウンロードするだけといった用途が一定または特化している場合にはコミュニティSDKのほうがなじみやすいかもしれません。</p> <h1 id="dropbox-apiの使い処">Dropbox APIの使い処</h1> <p>Dropbox上でできる主要操作はだいたいDropbox APIを利用すれば実現できます。また逆に、APIでなければ実現できないものもあります。少し実例を元に紹介していきましょう。</p> <h2 id="共有リンクのパスワード有効期限を一括設定する">共有リンクのパスワード/有効期限を一括設定する</h2> <p>Dropbox ProfessionalやDropbox Business契約があるばあいには、<a href="https://www.dropbox.com/help/files-folders/link-expiration">共有リンクへパスワードや有効期限を設定することができます</a>。ただ、共有リンク一つ一つに画面から設定するのは面倒なので一括設定したいと考えることもあります。こういったときにDropbox APIを利用すると実現できます。</p> <p>たとえば拙作<a href="https://github.com/watermint/toolbox/releases/tag/22.20171004.2">toolbox</a>ではこの操作を実装しました。</p> <p>Business Endpointsのアクセス権「Team member file access」を使い、すべてのユーザーについて共有リンク一覧を取得します。</p> <p>すべてのユーザーに対して処理を行うにはまず<a href="https://www.dropbox.com/developers/documentation/http/teams#team-members-list">teams/members/list</a>でアカウント一覧を取得します。各ユーザーについて<a href="https://www.dropbox.com/developers/documentation/http/documentation#sharing-list_shared_links">sharing/list_shared_links</a> APIでリンクを取得するのですがこのときに、<a href="https://www.dropbox.com/developers/documentation/http/teams#teams-member-file-access">Member file access</a>にあるとおり、HTTPヘッダに<code class="highlighter-rouge">Dropbox-API-Select-User: チームメンバーID</code>を追加すると、その該当アカウントとして処理が行われます。</p> <p>共有リンクが取得できたら、同様に<code class="highlighter-rouge">Dropbox-API-Select-User: チームメンバーID</code>を使って、各ユーザーそれぞれの共有リンクについて<a href="https://www.dropbox.com/developers/documentation/http/documentation#sharing-modify_shared_link_settings">sharing/modify_shared_link_settings</a>を使って有効期限を今日から7日後などに上書きします。</p> <h2 id="共有フォルダへの参加者一覧">共有フォルダへの参加者一覧</h2> <p>監査などの目的でDropbox Businessチーム内の各利用者が参加している共有フォルダの参加者一覧を取得したい場合があるとします。 これも以前Pythonで実装したことがあります。</p> <ul> <li><a href="https://github.com/dropbox/DropboxBusinessScripts/blob/master/Sharing/ListSharedFolderMembers.py">ListSharedFolderMembers.py</a></li> </ul> <p>Business Endpointsのアクセス権「Team member file access」を使い、すべてのユーザーについて処理を行います。 共有フォルダの場合にはアクセス権限がメンバー単位だけでなくグループ単位の場合もあるのでグループ情報を取得するために<a href="https://www.dropbox.com/developers/documentation/http/teams#team-groups-list">teams/groups/list</a>なども使っています。</p> <h2 id="大量ファイルのコピー移動削除など">大量ファイルのコピー/移動/削除など</h2> <p>Web画面から操作する際にファイルが一定数を超えていると処理ができない旨が表示されます。Dropboxアプリケーション実行すれば大量ファイルでも処理はできるのですが、パソコン上に同期していない場合などでは処理ができないのと、パソコンにやや負荷もかかります。</p> <p>このためそれぞれのファイルを逐次コピーないし、移動するようにUser EndpointsのAPIを使えば着実に処理を進めることができます。コピーであれば<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-copy_v2">files/copy_v2</a>、移動であれば<a href="https://www.dropbox.com/developers/documentation/http/documentation#files-move_v2">files/move_v2</a>といったAPIを使います。</p> <p>なおAPIを使った場合でもAPIドキュメントにあるとおり10,000ファイル以上を同時に処理することはできません。</p> <blockquote> <p>too_many_files The operation would involve more than 10,000 files and folders.</p> </blockquote> <p>小分けにして処理する必要があります。</p> <h2 id="ログイン済みデバイス一覧や強制ログアウト">ログイン済みデバイス一覧や強制ログアウト</h2> <p>Business Endpointsの<a href="https://www.dropbox.com/developers/documentation/http/teams#team-devices-list_members_devices">team/devices/list_member_devices</a> APIを使うとDropbox Businessチーム内のデスクトップ、モバイル、Webとそれぞれのセッション一覧を取得することができます。セッション情報には最終接続IPアドレスやUser Agentなども含まれるので、一定のルールを元に強制ログアウトを実施すると行った使い方もできます。たとえば、社内IP以外が検出されたら強制ログアウトなど。</p> <p>強制ログアウトのためには<a href="https://www.dropbox.com/developers/documentation/http/teams#team-devices-revoke_device_session">team/devices/revoke_device_session</a> APIを使います。</p> <h1 id="まとめ">まとめ</h1> <p>Dropbox APIを使うと社内ワークフローと連携して自動処理を行ったり、運用ポリシーなどに合わせて管理する、あるいはDevOpsのように開発ワークフローと組み合わせて、Dropboxの特定フォルダにファイルがアップロードされたらビルド開始。といったことも実現可能です。</p> <p>お作法はあるていどあるものの、一度覚えてしまえばやりたいことが簡潔に書けるようなAPIがそろっているかなと思います。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/11/07/travel-small-articles/"> 旅行の小物整理 </a> </h1> <span class="post-date"> 7th November 2017</span> <span class="post-tags"> #<a href="/tags/smallarticle">smallarticle</a> #<a href="/tags/travel">travel</a> </span> <p>海外旅行や海外出張に行く際、小物整理は意外とやっかいでした。今回はそういった海外旅行の際の小物整理で工夫していることをまとめます。旅行時の小物と行っても様々です。今回は次のように主に小さく薄っぺらいものをまとめて整理する方法について。</p> <ul> <li>パスポートや航空券など大事な書類</li> <li>入国時の申請書類など</li> <li>予備のクレジットカードやキャッシュカード</li> <li>現地で受け取ったレシート (家計簿や経費精算などのために整理したい)</li> <li>現地でもらったレストランなどのショップカード、観光地のパンフレット</li> <li>現地で利用するSIMカードまたは、交換した日本のSIMカード</li> </ul> <p>これまで数年は<a href="http://amzn.to/2iBOpXq">BRUNOのトラベルオーガナイザー</a>を使っていました。パスポートや航空券、カード類が整理できるようになっていてとても便利です。それ以前は手帳に挟んだり、鞄のポケットにいれたり統一感無く管理していたので、入国管理や税関などで書類を提出する際もあたふたしていました。このトラベルオーガナイザーを使って整理したことで入出国時のストレスが少し解消されました。</p> <p><img src="/images/2017-11-07-travel1.jpg" alt="トラベルオーガナイザー"/></p> <p>革製でかっこよく、丈夫なので航空券が折れ曲がったりもせず気に入って使っていました。ただ、ここ数回の旅行では今までよりも小さな鞄を持って旅行していたのでこのわずかな厚みも気になるようになってしまいました。また、旅行先で受け取ったレシートなどもトラベルオーガナイザーに入れてしまうとかなり分厚くなってしまいます。 鞄には出張時であればノートパソコン(15インチのMacBook Pro)、iPad、携帯電話、それぞれの充電器(乗り継ぎ待ちの際利用)を入れていてこれだけでほぼ鞄がいっぱいに。この結果、トラベルオーガナイザーも出し入れがやや窮屈に。</p> <p>また旅行券も以前はほとんどの場合、磁気ストライプのあるハガキぐらいのやや厚手な紙が使われていました。これが最近、バーコードを読み取るだけにかわり薄っぺらい感熱紙のような紙が使われる場合も増えてきました。あまり薄っぺらいと、トラベルオーガナイザーの収納ポケットの形によっては整理する際にやや手間取ります。</p> <p>そこで直近の海外出張では<a href="http://amzn.to/2Ao4HLj">B6サイズのメッシュケース</a>を使い始めました。よく銀行の通帳やキャッシュカードをひとまとめに整理するために使ったりするケースです。</p> <p><img src="/images/2017-11-07-travel2.jpg" alt="メッシュケース"/></p> <p>なかなか丈夫で信頼性のあるケースで、何より価格も手ごろです。B6サイズのメッシュケースは210mm x 170mmとA5サイズがきっちり入るサイズです。このシリーズではマチの部分も考慮して一回り小さめの呼称をしているのだと思います。 あまり気にしていませんでしたが、最近乗ったJALやBritish Airwaysの航空券のサイズは20cmちょっと x 8cmちょっとでぴったり入りました。</p> <p>このセキセイのメッシュケースはチャック部分が色違いの赤と青のものがあります。この2種類を目的別に使い分けることにしました。 一つ目はチャックが赤色のもので重要なものを入れます。これから利用する航空券やパスポート、SIMカードなど。 二つ目はチャックが青色のものであまり重要ではないものを入れます。レシートや地図など。</p> <p>このように整理すれば入出国時にもバタバタしませんし、もともと薄手なのでかさばりません。重要ではない青色チャックのメッシュケースがもし手荷物に入らなければ、預け荷物に入れることもできます。</p> <p>うまくいったので、2種類だけではなく、目的別にもう少し種類を増やしてみようかとも考えましたがあまり多すぎるとまたそれはそれでゴチャゴチャしてしまうのでせいぜい2種類ぐらいが良さそうです。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/09/28/unihertz-jelly/"> Unihertz Jellyレビュー </a> </h1> <span class="post-date"> 28th September 2017</span> <span class="post-tags"> #<a href="/tags/android">android</a> #<a href="/tags/jelly">jelly</a> #<a href="/tags/travel">travel</a> </span> <p><a href="https://www.kickstarter.com/projects/jellyphone/jelly-the-smallest-4g-smartphone">The Smallest 4G Smartphone</a>と、世界最小を謳う4GスマートフォンJelly。Kickstarterにて目標額を達成し、正式に発売されることになりました。今月上旬に手に入れることができたので少しレビューをしてみたいと思います。仕様などについてはKickstarterサイトや他のレビューなどが詳しいので、使用感を中心にレビューしたいと思います。</p> <p>メモリー容量の違うJellyとJelly Proという2モデルがあり、メモリー容量が小さいJellyのほうは発売前に廃盤となってしまったのでKickstarter限定となってしまいました。今回購入したのはメモリー容量の小さいJellyのほうです。</p> <p>なお残念ながら現状、技適を取得していないため日本では電波を発することができません。海外旅行時のバックアップ用として購入しましたが、ちょうど今月海外へ行く機会があったので実際に使ってきました。SIMは<a href="https://www.mtxc.eu/">MTXC</a>のものを準備しています。1GB、15日間で約20ユーロです。</p> <p><img src="/images/2017-09-16-jelly.jpg" alt="利用の様子"/></p> <p>今回はヘルシンキ、ダブリン、ロンドンで使ってきました。世界最小を謳うだけあり、確かに小さい。まだ現役で使っているiPhone 5sよりもずっと小さい。画面も2.45インチでキーボード入力などもかなり難しく、バリバリ使う。というよりは、補助的な利用方法がメインになるかと思います。</p> <p>Google Mapで地図を確認するにも小さすぎ、実用上は大雑把に把握する程度に考えておいた方が良さそうです。一方で、Turn-by-turnナビゲーション機能を使った場合はそれなりに視認性もよいので、このスマートフォンで一番しっくり来るように思いました。画面をずっとにらめっこするタイプではなく、信号待ちのときなどに方向を確認するぐらいの使い方が合っているのでしょう。</p> <p>街歩きで使ってみたところ、デジタルコンパスがなかなかうまく正しい方向を向いてくれません。しばらく歩いていると方向があってくるので、街の風景を楽しみつつときどき方向を確認するぐらいでいいのだと思います。</p> <p>バッテリーがどの程度持つかは気になるところでしたが、全くゼロになることはありませんでした。ただGoogle Mapなどそれなりに使っていると丸一日は持たないかなというぐらいの印象で、やはりバリバリいろいろ調べながら街歩きをするためのスマートフォンではありません。周りの風景を楽しみながら適当に散策し、迷子になったり時間の余裕がなくなってきたときの最終手段としてポケットに忍ばせておくぐらいのつもりで使っていると便利でしょう。</p> <p>予備バッテリーを持ち歩くという手段もありますが、バッテリーを持ち歩くぐらいだったら、iPhone 5sのほうがバッテリーの持ち、サイズ感など考えた場合により使いやすいと思います。電波の入り方はヘルシンキ、ダブリン、ロンドンのいずれでも特に不満はなくGoogle Mapも普通に利用できました。</p> <p>総評:</p> <p>知らない街をあるくときの安心材料としてポケットに入れておくぐらいの使い方が良さそうです。レビューを見ながらレストランを探したり、写真を撮ってSNSにアップロードするような使い方は向いていません。ぶらり入ったレストランがたまたま美味しかったり、適当に歩いた先にあった公園がきれいだったりするのを楽しみながら旅するためのスマートフォンです。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/08/30/jjug-ccc/"> JJUG CCC 2017 Spring </a> </h1> <span class="post-date"> 30th August 2017</span> <span class="post-tags"> #<a href="/tags/ccc">ccc</a> #<a href="/tags/java">java</a> #<a href="/tags/jjug">jjug</a> </span> <p><img src="/images/2017-05-20-jjug-ccc.jpg" alt="JJUG CCC 2017 Spring"/></p> <p>ブログを書くまでがJJUG CCC、ということではありますが、かなり、、時間が経ってしまいました。6月頃に書き始めたものを再編集しているのと記憶もややあやふやな部分があり不正確な点もあるかとおもいますがご容赦ください。<a href="http://www.java-users.jp/ccc2017spring/">JJUG CCC 2017 Spring</a>へ参加した話を思い出しながらまとめています。</p> <p>今回は年次総会の後に行われたJJUG CCC 20th fireside chatというセッションにて登壇させていただきました。発表者は「20回生き残っている幹事たち」ということでしたが、僕が実際にJJUG幹事として参加させてもらっているのは手元の記録が確かならば2009年6月からで20回すべてには幹事として参加していませんが、最初の頃はSun Microsystems社でJavaエバンジェリストとして関わっていたというオマケで加えてもらっています。</p> <p>お話しした内容は当日のアドリブで、正確には覚えていませんが大まかに当日お話した内容に注釈を加えつつ振り返ってみます。</p> <h1 id="ria">RIA</h1> <p>2007年頃といえばAdobeのAir、MicrosoftのSilverlightといったRIA (Rich Internet Application)が流行っていたように思います。RIAという言葉はほぼ死語ですが、現在のスマートフォン・タブレット向けのアプリ、あるいはMac App StoreやWindows StoreのようなデスクトップアプリとしてRIAという言葉は消え去ってもコンセプトとしては完全に当たり前のものとなりました。</p> <p>初代iPhoneもこの年に発表されていますが、RIAの流れに続く原動力を作ったのは個人的には2005年にGoogle Mapsがリリースされたことだと思っています。個人的にも衝撃的でしたし、多くのインターネットユーザーや企業IT部門の考え方まで大きく変えていった原動力になったのではないかと思っています。当時、Web上で地図を見ると言えば住所で検索したり、上下左右ボタン、縮尺変更を押して切り取られた地図を次々に見ていく。というスタイルだったと思いますがマウスによるスクロールや縮尺変更は圧倒的にわかりやすく仕上げられていました。AjaxというWebテクノロジーもGoogle Mapsの発表を境に大きく花開いたと記憶しています。</p> <p>さて、Java界でのRIAといえば、JavaFX。もともと、ICAN SuiteというSOA基盤ソフトウエアで知られていたSeeBeyondという会社を2005年にSunが買収したところが始まりです。SeeBeyondに在籍していたChris Oliverが個人プロジェクトとして作っていたF3というスクリプト言語が出発点となっています。2007年5月のJavaOneではJavaFXという名前で目玉としてキーノートにて発表されました。</p> <p>当時の記事を少し読み返してみました。</p> <ul> <li><a href="http://www.itmedia.co.jp/enterprise/articles/0705/11/news038.html">2007 JavaOneのトピック「JavaFX」とは何か (ITmedia)</a></li> <li><a href="http://gihyo.jp/dev/feature/01/javaone2007/0001">速報！2007 JavaOne Conference (Gihyo.jp)</a></li> <li><a href="http://news.mynavi.jp/articles/2007/05/11/javafx/">JavaFXの実態を暴け! JavaOne 2007で発表されたばかりの新RIA言語を試す</a></li> </ul> <p>2007発表されたJavaFXではJavaFX Scriptというスクリプト言語が同時に発表されています(これはまさに前述のF3そのものです)。GUI記述について、無理なく自然な記述ができるスクリプト言語です。JavaをiOS/macOSにおけるObjective Cとするならば、JavaFX ScriptはSwiftのような存在です。</p> <p>F3という名前は”Form Follows Function” (形態は機能に従う)を元としているそうです。Chrisとは話をしたことはありませんでしたが、JavaOneセッションやブログなどで発信されていた彼のF3へのこだわりと、JavaFXをJavaのRIA基盤としてエコシステムを築き上げたいSunとの思惑は当時から少しずつずれているように感じていたように記憶しています。</p> <p>その後、JavaFX 2.0が2011年に発表されるとJavaFX Scriptは廃止となり、Javaからネイティブに呼び出しができるライブラリの一つとなりました。2011年、すでに多言語実行プラットホームとなっているJavaにとって、ライブラリとして存在を変えることはまさに”Form Follows Function”であったのだと感慨深く思い出します。</p> <h1 id="webサービス">Webサービス</h1> <p>10年程度前で記憶のあるトピックとしては2006年、Project Tangoという名前で.NET(Windows Communication Foundation)とJavaをWebサービスで相互運用するという発表があったことです。Project TangoはWeb Services Interoperability Technology (WSIT)という名前の成果物でWS-Security、WS-PolicyなどWS-I基礎的な仕様についてまとめ相互運用できるようパッケージ化されたものです。</p> <p>今でこそ、APIを使ったサービス間連携というのはもはや何の疑いもなく当たり前のものとなっていますが、.NETとJavaで相互運用するということだけでニュースバリューになるぐらい相互運用するというのはまだ早熟な時期であったと思っています。</p> <p>その後、RESTful APIというキーワードに注目が集まりより簡単にAPIが提供でき、利用できるになりプログラミング言語やOS環境に依存しないという土壌はどんどん整っていきました。</p> <p>電話をかけるAPI、テキストを翻訳するAPI、株価や天気予報のAPIなど様々なAPIを組み合わせて新しいサービスを作るというのはシステム開発のなかでも珍しいことではなくなりました。<a href="http://mashupaward.jp/">Mashup Awards</a>という取り組みも2006年に始まっていていまもどんどん規模を拡大しているようです。</p> <p>前述のようなRIAが目指した使いやすいインターネット向けUIはAPIを通じたサービス提供ならびにサービス利用が増えるに従ってその地盤を確固たるものになっていったものだと思っています。サーバサイドで起こっていた相互運用性やSOAなどのようなエコシステム、スマートフォンやタブレット、デスクトップ環境向けの「アプリ」というエコシステムは決してどちらか片方だけでは成り立ち得なかったのだろうと思っています。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2017/08/29/nexus7-android-7-1-2/"> Nexus 7 (2012)をAndroid 7.1.2にバージョンアップ </a> </h1> <span class="post-date"> 29th August 2017</span> <span class="post-tags"> #<a href="/tags/android">android</a> #<a href="/tags/nexus7">nexus7</a> </span> <p>Nexus 7 (2012)が自動バージョンアップによってアップデートされた最終バージョンがAndroid 5.1.1。このバージョンになってからひどく端末が遅くなり、使い勝手ががくんと落ちてしまいました。このため今では手元にある数少ないNFC対応端末として、Suicaの利用履歴を<a href="https://play.google.com/store/apps/details?id=com.moneyforward.nfcreader">Moneyforwardのアプリケーション</a>でMoneyforwardに転送するぐらいの使い道にしか使っていませんでした。</p> <p>軽量で手頃なサイズなのでもう少し使い勝手が上がればいいなということと、単純に新しいAndroidを触ってみたいということでAndroid 7.1.2へバージョンアップしてみることにしました。いくつか失敗しながらとなったので備忘録として残しておきます。なおメーカーサポート外となりますので自己責任にて。</p> <h1 id="参考にしたサイト">参考にしたサイト</h1> <ul> <li><a href="http://dandar3.blogspot.jp/2016/12/android-71-nougat-on-nexus-7-2012-wifi.html">Android 7.1 Nougat on Nexus 7 2012 WiFi</a></li> <li><a href="https://forum.xda-developers.com/nexus-7/development/rom-android-7-aosp-grouper-t3467514">ROM 7.1.2_r33 NZH54D Grouper Tilapia F2FS/EXT4 Android 7.x AOSP</a></li> <li><a href="https://twrp.me/devices/asusnexus72012wifi.html">TWRP for Asus Nexus 7 2012 Wi-Fi</a></li> </ul> <h1 id="手順">手順</h1> <p>試行錯誤しながら＋うろ覚え部分もありますがだいたい次のような流れです。</p> <h2 id="nexus-7のデータをバックアップ">Nexus 7のデータをバックアップ</h2> <p>このアップデートのタイミングでデータは一度消去するのでバックアップをとっておきます</p> <h2 id="nexus-7を開発者モードに">Nexus 7を開発者モードに</h2> <ul> <li>設定→端末詳細→ビルド番号でビルド番号を7回ぐらいタップ</li> <li>設定→開発者向けオプションでUSBデバッグをONに</li> </ul> <h2 id="platform-toolsをダウンロード">Platform Toolsをダウンロード</h2> <ul> <li><a href="https://developer.android.com/studio/releases/platform-tools.html">SDK Platform Tools</a></li> </ul> <h2 id="android-712等をダウンロード">Android 7.1.2等をダウンロード</h2> <p><a href="https://forum.xda-developers.com/nexus-7/development/rom-android-7-aosp-grouper-t3467514">ROM 7.1.2_r33 NZH54D Grouper Tilapia F2FS/EXT4 Android 7.x AOSP</a>に掲載されているものをダウンロード。</p> <ul> <li>Wifiモデル用(Grouper) : <a href="https://www.androidfilehost.com/?fid=745425885120754981">Build 20170811</a></li> <li>Wifi+Celluarモデル用(Tilapia) : <a href="https://www.androidfilehost.com/?fid=961840155545588227">Build 20170811</a></li> <li>Gappsfor 7.1.x : <a href="https://www.androidfilehost.com/?fid=889764386195918677">BeansGapps-Mini-7.1.x-20170725.zip</a></li> <li>TWRP for grouper : <a href="https://dl.twrp.me/grouper/">twrp-3.1.1-0-grouper.img</a></li> </ul> <p>Gappsは最初<a href="http://dandar3.blogspot.jp/2016/12/android-71-nougat-on-nexus-7-2012-wifi.html">Android 7.1 Nougat on Nexus 7 2012 WiFi</a>に記載のあるOpenGappsを入れてみたのですがAndroid 7.1.2起動直後の初期設定アプリがクラッシュするためBeansGappsを使いました。</p> <p>OpenGappsでもキャッシュをクリアしたりすれば大丈夫だったというような報告をみて試してみましたが、手元ではうまくいかず最終的にBeansGappsでは問題ありませんでした。</p> <h2 id="ブートローダーのアンロックとtwrpの導入">ブートローダーのアンロックとTWRPの導入</h2> <p>パソコンとNexus 7をUSB接続してブートローダーのアンロック。Platform Toolsのなかに入っている<code class="highlighter-rouge">adb</code>コマンドと<code class="highlighter-rouge">fastboot</code>コマンドを使います。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adb reboot bootloader
$ fastboot oem unlock
</code></pre></div></div> <p>次にtwrpイメージの書き込み。twrpのファイル名は適当に読み替えてください。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ fastboot flash recovery twrp-x.x.x-x-x.img
$ fastboot reboot
</code></pre></div></div> <p><a href="https://twrp.me/devices/asusnexus72012wifi.html">TWRP for Asus Nexus 7 2012 Wi-Fi</a>に記載のあるとおり最後のリブートコマンド実行時にすこし注意が必要です。</p> <blockquote> <p>Note many devices will replace your custom recovery automatically during first boot. To prevent this, use Google to find the proper key combo to enter recovery. After typing fastboot reboot, hold the key combo and boot to TWRP. Once TWRP is booted, TWRP will patch the stock ROM to prevent the stock ROM from replacing TWRP. If you don’t follow this step, you will have to repeat the install.</p> </blockquote> <p>最後にリブートする際、Nexus 7のボリュームダウンボタンと電源ボタンを長押しします。これにより書き込んだカスタムリカバリーが自動的に工場出荷状態に戻されることを防ぎます。</p> <h2 id="osとgappsの導入">OSとGappsの導入</h2> <p>あとは<a href="http://dandar3.blogspot.jp/2016/12/android-71-nougat-on-nexus-7-2012-wifi.html">Android 7.1 Nougat on Nexus 7 2012 WiFi</a>にある手順5から順に実行していきます。スクリーンショットをとらなかったのでスクリーンショットを参照されたい方は該当記事をご参照ください。</p> <p>リカバリモードで起動。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adb reboot-bootloader
</code></pre></div></div> <p>起動するとコマンドが表示されているのですが、ボリュームアップ・ダウンで選択し電源ボタンで実行できます。ボリュームダウンボタンを何回か押して「Recovery Mode」を選んで電源ボタンで実行します。</p> <p>この後の手順は下記の通りです。</p> <ul> <li>Wipeを選んでFactory Resetを実行します。</li> <li>TWRPのメインメニューまで戻り、Advanced→ADB Sideloadまで進みスワイプしてsideloadを開始します</li> <li>パソコンから<code class="highlighter-rouge">$ adb sideload aosp_grouper-7.1.2-ota-eng-20170811.ds.zip</code>とコマンドを実行してOSイメージを書き込みます。</li> <li>次にGappsを書き込みますが、またTWRPのメインメニューまでもどりAdvanced→ADB Sideloadまで進み、今度はWipe Dalvik Cacheを選択した状態でスワイプします</li> <li>パソコンから<code class="highlighter-rouge">$ adb sideload BeansGapps-Mini-7.1.x-20170725.zip</code>としてGappsを導入します。</li> <li>Reboot Systemを選択してリブートします。TWRPのアプリを入れるかどうか聞いてきますが、これはどちらでもよいでしょう。</li> </ul> <h2 id="その後の設定など">その後の設定など</h2> <p>起動後にはAndroidの初期設定を勧めていきます。Wifiの設定などを行い、設定を勧めていけば完了です。Play Storeアプリはインターネット接続されていれば自動的にダウンロードされてきます。</p> </div> </div> <div class="pagination"> <a class="pagination-item older" href="/page4">Older</a> <a class="pagination-item newer" href="/page2">Newer</a> </div> </div> <div class="container copyright"> &copy; 2005-2018 Takayuki Okazaki </div> </div> <label for="sidebar-checkbox" class="sidebar-toggle"></label> <script>!function(e){var c=e.querySelector(".sidebar-toggle"),r=e.querySelector("#sidebar"),t=e.querySelector("#sidebar-checkbox");e.addEventListener("click",function(e){var n=e.target;t.checked&&!r.contains(n)&&n!==t&&n!==c&&(t.checked=!1)},!1)}(document);</script> <script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-769616-6","auto"),ga("send","pageview");</script> </body> </html>