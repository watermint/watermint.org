<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> watermint.org &middot; Takayuki Okazaki's note </title> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/watermint-logo.png"> <link rel="shortcut icon" href="/public/watermint-logo.png"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <style>*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:serif;font-size:14px;line-height:1.8}@media(min-width:38em){html{font-size:20px}}body{color:#515151;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#268bd2;text-decoration:none}a strong{color:inherit}a:hover,a:focus{text-decoration:underline}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:bold;line-height:1.25;color:#313131;text-rendering:optimizeLegibility}h1{font-size:1.5rem;margin-top:1.6rem;margin-bottom:1.6rem}h2{margin-top:1.6rem;font-size:1.3rem}h3{margin-top:1.6rem;font-size:1.2rem}h4,h5,h6{margin-top:1rem;font-size:1rem}p{margin-top:0;margin-bottom:1rem}strong{color:#303030}ul,ol,dl{margin-top:0;margin-bottom:1rem}dt{font-weight:bold}dd{margin-bottom:.5rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee;border-bottom:1px solid #fff}abbr{font-size:85%;font-weight:bold;color:#555;text-transform:uppercase}abbr[title]{cursor:help;border-bottom:1px dotted #e5e5e5}code,pre{font-family:Menlo,Monaco,"Courier New",monospace}code{padding:.25em .5em;font-size:85%;color:#bf616a;background-color:#f9f9f9;border-radius:3px}pre{display:block;margin-top:0;margin-bottom:1rem;padding:1rem;font-size:.8rem;line-height:1.4;white-space:pre;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background-color:#f9f9f9}pre code{padding:0;font-size:100%;color:inherit;background-color:transparent}.highlight{margin-bottom:1rem;border-radius:4px}.highlight pre{margin-bottom:0}.gist .gist-file{font-family:Menlo,Monaco,"Courier New",monospace!important}.gist .markdown-body{padding:15px}.gist pre{padding:0;background-color:transparent}.gist .gist-file .gist-data{font-size:.8rem!important;line-height:1.4}.gist code{padding:0;color:inherit;background-color:transparent;border-radius:0}blockquote{padding:.5rem 1rem;margin:.8rem 0;color:#7a7a7a;border-left:.25rem solid #e5e5e5}blockquote p:last-child{margin-bottom:0}@media(min-width:30em){blockquote{padding-right:5rem;padding-left:1.25rem}}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;border:1px solid #e5e5e5;border-collapse:collapse}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}.lead{font-size:1.25rem;font-weight:300}.message{margin-bottom:1rem;padding:1rem;color:#717171;background-color:#f9f9f9}.container{max-width:38rem;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:#c0c0c0;letter-spacing:0}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.post-tags{display:block;margin-top:-.5rem;margin-bottom:1rem;text-align:right}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:"PT Sans",Helvetica,Arial,sans-serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media(min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}html,body{overflow-x:hidden;line-height:1.9em}html{font-family:serif}h1,h2,h3,h4,h5,h6{font-weight:400;color:#313131}.wrap{position:relative;width:100%}.container{max-width:28rem}@media(min-width:38em){.container{max-width:32rem}}@media(min-width:56em){.container{max-width:38rem}}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem;border-bottom:1px solid #eee}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:#c0c0c0;letter-spacing:0}@media(max-width:48em){.masthead-title{text-align:center}.masthead-title small{display:none}}.sidebar{position:fixed;top:0;bottom:0;left:-14rem;width:14rem;visibility:hidden;overflow-y:auto;font-family:serif;font-size:.875rem;line-height:1.4em;color:rgba(255,255,255,.6);background-color:#202020;-webkit-transition:all .3s ease-in-out;transition:all .3s ease-in-out}
@media(min-width:30em){.sidebar{font-size:.75rem}}.sidebar a{font-weight:normal;color:#fff}.sidebar-item{padding:1rem}.sidebar-item p:last-child{margin-bottom:0}.sidebar-nav{border-bottom:1px solid rgba(255,255,255,.1)}.sidebar-nav-item{display:block;padding:.5rem 1rem;border-top:1px solid rgba(255,255,255,.1)}.sidebar-nav-item.active,a.sidebar-nav-item:hover,a.sidebar-nav-item:focus{text-decoration:none;background-color:rgba(255,255,255,.1);border-color:transparent}@media(min-width:48em){.sidebar-item{padding:1.5rem}.sidebar-nav-item{padding-left:1.5rem;padding-right:1.5rem}}.sidebar-checkbox{position:absolute;opacity:0;-webkit-user-select:none;-moz-user-select:none;user-select:none}.sidebar-toggle{position:absolute;top:.8rem;left:1rem;display:block;padding:.25rem .75rem;color:#555;border-radius:.25rem;cursor:pointer}.sidebar-toggle:before{display:inline-block;width:1rem;height:.75rem;content:"";background-image:-webkit-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:-moz-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:-ms-linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%);background-image:linear-gradient(to bottom,#555,#555 20%,#fff 20%,#fff 40%,#555 40%,#555 60%,#fff 60%,#fff 80%,#555 80%,#555 100%)}.sidebar-toggle:active,#sidebar-checkbox:focus ~ .sidebar-toggle,#sidebar-checkbox:checked ~ .sidebar-toggle{color:#fff}.sidebar-toggle:active:before,#sidebar-checkbox:focus ~ .sidebar-toggle:before,#sidebar-checkbox:checked ~ .sidebar-toggle:before{background-image:-webkit-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:-moz-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:-ms-linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%);background-image:linear-gradient(to bottom,#fff 0%,#fff 20%,#d28445 20%,#d28445 40%,#fff 40%,#fff 60%,#d28445 60%,#d28445 80%,#fff 80%,#fff 100%)}@media(min-width:30.1em){.sidebar-toggle{position:fixed}}@media print{.sidebar-toggle{display:none}}.wrap,.sidebar,.sidebar-toggle{-webkit-backface-visibility:hidden;-ms-backface-visibility:hidden;backface-visibility:hidden}.wrap,.sidebar-toggle{-webkit-transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out}#sidebar-checkbox:checked+.sidebar{z-index:10;visibility:visible}#sidebar-checkbox:checked ~ .sidebar,#sidebar-checkbox:checked ~ .wrap,#sidebar-checkbox:checked ~ .sidebar-toggle{-webkit-transform:translateX(14rem);-ms-transform:translateX(14rem);transform:translateX(14rem)}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media(min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}.layout-reverse .sidebar{left:auto;right:-14rem}.layout-reverse .sidebar-toggle{left:auto;right:1rem}.layout-reverse #sidebar-checkbox:checked ~ .sidebar,.layout-reverse #sidebar-checkbox:checked ~ .wrap,.layout-reverse #sidebar-checkbox:checked ~ .sidebar-toggle{-webkit-transform:translateX(-14rem);-ms-transform:translateX(-14rem);transform:translateX(-14rem)}.theme-base-08 .sidebar,.theme-base-08 .sidebar-toggle:active,.theme-base-08 #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#ac4142}.theme-base-08 .container a,.theme-base-08 .sidebar-toggle,.theme-base-08 .related-posts li a:hover{color:#ac4142}.theme-base-09 .sidebar,.theme-base-09 .sidebar-toggle:active,.theme-base-09 #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#d28445}.theme-base-09 .container a,.theme-base-09 .sidebar-toggle,.theme-base-09 .related-posts li a:hover{color:#d28445}.theme-base-0a .sidebar,.theme-base-0a .sidebar-toggle:active,.theme-base-0a #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#f4bf75}
.theme-base-0a .container a,.theme-base-0a .sidebar-toggle,.theme-base-0a .related-posts li a:hover{color:#f4bf75}.theme-base-0b .sidebar,.theme-base-0b .sidebar-toggle:active,.theme-base-0b #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#90a959}.theme-base-0b .container a,.theme-base-0b .sidebar-toggle,.theme-base-0b .related-posts li a:hover{color:#90a959}.theme-base-0c .sidebar,.theme-base-0c .sidebar-toggle:active,.theme-base-0c #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#75b5aa}.theme-base-0c .container a,.theme-base-0c .sidebar-toggle,.theme-base-0c .related-posts li a:hover{color:#75b5aa}.theme-base-0d .sidebar,.theme-base-0d .sidebar-toggle:active,.theme-base-0d #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#6a9fb5}.theme-base-0d .container a,.theme-base-0d .sidebar-toggle,.theme-base-0d .related-posts li a:hover{color:#6a9fb5}.theme-base-0e .sidebar,.theme-base-0e .sidebar-toggle:active,.theme-base-0e #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#aa759f}.theme-base-0e .container a,.theme-base-0e .sidebar-toggle,.theme-base-0e .related-posts li a:hover{color:#aa759f}.theme-base-0f .sidebar,.theme-base-0f .sidebar-toggle:active,.theme-base-0f #sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#8f5536}.theme-base-0f .container a,.theme-base-0f .sidebar-toggle,.theme-base-0f .related-posts li a:hover{color:#8f5536}.sidebar-overlay #sidebar-checkbox:checked ~ .wrap{-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0)}.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar-toggle{box-shadow:0 0 0 .25rem #fff}.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar{box-shadow:.25rem 0 .5rem rgba(0,0,0,.1)}.layout-reverse.sidebar-overlay #sidebar-checkbox:checked ~ .sidebar{box-shadow:-.25rem 0 .5rem rgba(0,0,0,.1)}.highlight table td{padding:5px}.highlight table pre{margin:0}.highlight,.highlight .w{color:#586e75}.highlight .err{color:#002b36;background-color:#dc322f}.highlight .c,.highlight .cd,.highlight .cm,.highlight .c1,.highlight .cs{color:#657b83}.highlight .cp{color:#b58900}.highlight .nt{color:#b58900}.highlight .o,.highlight .ow{color:#93a1a1}.highlight .p,.highlight .pi{color:#93a1a1}.highlight .gi{color:#859900}.highlight .gd{color:#dc322f}.highlight .gh{color:#268bd2;background-color:#002b36;font-weight:bold}.highlight .k,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .kv{color:#6c71c4}.highlight .kc{color:#cb4b16}.highlight .kt{color:#cb4b16}.highlight .kd{color:#cb4b16}.highlight .s,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .s2,.highlight .sh,.highlight .sx,.highlight .s1{color:#859900}.highlight .sr{color:#2aa198}.highlight .si{color:#d33682}.highlight .se{color:#d33682}.highlight .nn{color:#b58900}.highlight .nc{color:#b58900}.highlight .no{color:#b58900}.highlight .na{color:#268bd2}.highlight .m,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .il,.highlight .mo,.highlight .mb,.highlight .mx{color:#859900}.highlight .ss{color:#859900}.copyright{font-size:.8em;font-style:italic;color:#555}</style> </head> <body class="theme-base-09"> <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"> <div class="sidebar" id="sidebar"> <div class="sidebar-item"> <p>Travel, camera, photo, and technical things. I work at Dropbox. Thoughts are my own.</p> </div> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Home</a> <a class="sidebar-nav-item" href="/about/">About</a> <a class="sidebar-nav-item" href="/archive/">Archive</a> <a class="sidebar-nav-item" href="/tags/">Tags</a> <a class="sidebar-nav-item" href="/atom.xml">Feed</a> <a class="sidebar-nav-item" href="https://github.com/watermint">Github</a> </nav> <div class="sidebar-item"> <p> &copy; 2005-2022 Takayuki Okazaki </p> </div> </div> <div class="wrap"> <div class="masthead"> <div class="container"> <h3 class="masthead-title"> <a href="/" title="Home">watermint.org</a> <small>- Takayuki Okazaki's note</small> </h3> </div> </div> <div class="container content"> <div class="posts"> <div class="post"> <h1 class="post-title"> <a href="/2020/11/21/remove_google_analytics_and_amazon_affiliate/"> No more user tracking on this site: Removed Google Analytics and Amazon Affiliate </a> </h1> <span class="post-date"> 21st November 2020</span> <span class="post-tags"> #<a href="/tags/amazonaffiliate">amazonaffiliate</a> #<a href="/tags/googleanalytics">googleanalytics</a> #<a href="/tags/privacy">privacy</a> </span> <p>I used to use Google Analytics and Amazon Affiliate links on this blog, but I have removed them. I will no longer track visitors to my site. I have also removed the past Google Analytics logs.</p> <p>This site currently use cookies only for delivery control, of delivery server <a href="https://support.cloudflare.com/hc/en-us/articles/200170156-Understanding-the-Cloudflare-Cookies">Cloudflare’s cookie</a>.</p> <p>This time it’s not because there was any particular problem to deal with Google Analytics or Amazon Affiliate. But because I didn’t usually use of analytics or affiliates. Additionally, privacy protection would be essential in the near future.</p> <p>More positively, the site’s display speed improved from a few seconds to about a second when I moved from <a href="/2013/09/03/migrate-my-wordpress-blog-to-tumblr/">WordPress to Tumblr</a> and then from <a href="/2016/12/12/tumblr-to-jekyll/">Tumblr to Github Pages</a>. This time, I changed the delivery infrastructure from Github Pages to <a href="https://workers.cloudflare.com/">Cloudflare Workers</a>. As a result, the display time became about 0.3 seconds, with the removal of Google Analytics. Finally, the site received a score of 100 in the evaluation by <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed</a>.</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2020/11/20/remove_google_analytics_and_amazon_affiliate/"> Google AnalyticsとAmazon Affiliateのトラッキングを削除しました </a> </h1> <span class="post-date"> 20th November 2020</span> <span class="post-tags"> #<a href="/tags/amazonaffiliate">amazonaffiliate</a> #<a href="/tags/googleanalytics">googleanalytics</a> #<a href="/tags/privacy">privacy</a> </span> <p>本ブログではGoogle AnalyticsとAmazon Affiliateのリンクをいくつか利用していましたが、それらを削除しました。これにより、本サイトにお越しいただいた方を追跡することはなくなりました。また、過去のGoogle Analyticsログについても削除いたしました。</p> <p>クッキーについては現在は、配信サーバである<a href="https://support.cloudflare.com/hc/ja/articles/200170156-Cloudflare-Cookie%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#12345682">Cloudflareのクッキー</a>のみでこちらは主に配信制御用のものです。</p> <p>今回は特に何か問題があったための対処ではなく、もともと分析やアフィリエイトも活用していなかったことと、プライバシー保護は今後基本的なものとなるだろうとの考えからです。</p> <p><img src="/images/2020-11-20-pagespeed.png" alt="PageSpeedで100点になりました"/></p> <p>もっと良い作用としてはサイトの表示スピードが速くなりました。<a href="/2013/09/03/migrate-my-wordpress-blog-to-tumblr/">WordPressからTumblrへ移行</a>し、<a href="/2016/12/12/tumblr-to-jekyll/">TumblrからGithub Pagesへ移行</a>したことで数秒かかっていた表示が1秒台ぐらいに改善していました。今回配信インフラをGithub Pagesから<a href="https://workers.cloudflare.com/">Cloudflare Workers</a>に変更したことが大きいですが、最後の一押しとしてGoogle Analyticsの削除でさらに高速化され表示時間は0.3秒程度になり、<a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed</a>による評価も無事100点をいただけました。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2020/11/04/dropbox-sharedlink-cli/"> Dropbox/Dropbox Business: 共有リンクを操作するCLI - watermint toolbox </a> </h1> <span class="post-date"> 4th November 2020</span> <span class="post-tags"> #<a href="/tags/cli">cli</a> #<a href="/tags/dropbox">dropbox</a> #<a href="/tags/dropboxbusiness">dropboxbusiness</a> #<a href="/tags/toolbox">toolbox</a> #<a href="/tags/waterminttoolbox">waterminttoolbox</a> </span> <p><a href="https://github.com/watermint/toolbox/">watermint toolbox</a>ではDropboxまたはDropbox Business用のコマンドを各種揃えています。今回はDropboxの個人アカウントまたはDropbox Businessチーム全体に対する共有リンクを操作するコマンドを紹介します。</p> <h1 id="共有リンクの一覧">共有リンクの一覧</h1> <p>チーム内の共有リンクをすべてレポートとして出力することで、監査や管理上の資料として利用できます。なお、このコマンドではチームメンバー全員の共有リンクを取得して一覧を作成しますので、チームメンバー数が多い場合には相応の時間がかかります。</p> <p>詳細は<a href="https://github.com/watermint/toolbox/blob/master/doc/generated_ja/team-sharedlink-list.md">マニュアル</a>に記載していますが、最新版のプログラムをダウンロードして解凍し、次のようなコマンドを実行します。なお、例ではプログラムをデスクトップに解凍したことを想定しています。</p> <p>WindowsではまずPowerShellを起動し、次のようなコマンドを実行します。(なお、PowerShellへの依存関係はなくコマンドプロンプトやバッチファイルからの起動でも動作します)</p> <p>まずデスクトップフォルダに移動します。</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cd</span><span class="w"> </span><span class="nx">Desktop</span><span class="w">
</span></code></pre></div></div> <p>続いてプログラムを実行します。</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="n">\tbx.exe</span><span class="w"> </span><span class="nx">team</span><span class="w"> </span><span class="nx">sharedlink</span><span class="w"> </span><span class="nx">list</span><span class="w">
</span></code></pre></div></div> <p>これでしばらく待つとレポートが作成されます。レポートファイルはCSV、xlsx、JSON形式の3種類出力され、画面上にレポートが作成されたパスが表示されます。レポートの書式については<a href="https://github.com/watermint/toolbox/blob/master/doc/generated_ja/team-sharedlink-list.md">マニュアル</a>を参照してください。</p> <h1 id="全体のチーム内の共有リンク有効期限を上書きする">全体のチーム内の共有リンク有効期限を上書きする</h1> <p>このコマンドでは共有設定で、リンクを知っている人全員となっているチーム内の共有リンクに対して有効期限を上書きすることで実質的には公開リンクを削除できます。有効期限の指定方法は現時点からの日数、または指定した日時です。</p> <p>たとえば有効期限を30日後に設定したい場合には次のように実行します。</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="n">\tbx.exe</span><span class="w"> </span><span class="nx">team</span><span class="w"> </span><span class="nx">sharedlink</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">expiry</span><span class="w"> </span><span class="nt">-days</span><span class="w"> </span><span class="nx">30</span><span class="w">
</span></code></pre></div></div> <p>これで全ての公開共有リンクの有効期限を30日に上書きします。なお、有効期限が30日以内であるばあいには上書きしませんので、定期的にこのコマンドを実行してチーム全体の有効期限を管理することも可能です。</p> <p>また、指定日時での有効期限指定も可能です。たとえば、年度末を有効期限としたい場合には次のように実行します。</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="n">\tbx.exe</span><span class="w"> </span><span class="nx">team</span><span class="w"> </span><span class="nx">sharedlink</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">expiry</span><span class="w"> </span><span class="nt">-at</span><span class="w"> </span><span class="nx">2021-04-01</span><span class="w">
</span></code></pre></div></div> <p>このように <code class="language-plaintext highlighter-rouge">-at</code> オプションに続けて日時を指定するとその日時で上書きします。 詳細は<a href="https://github.com/watermint/toolbox/blob/master/doc/generated_ja/team-sharedlink-update-expiry.md">マニュアル</a>をご参照ください。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2020/08/03/netgear-rax120/"> WIFIルーター評: NETGEAR RAX120 </a> </h1> <span class="post-date"> 3rd August 2020</span> <span class="post-tags"> #<a href="/tags/netgear">netgear</a> #<a href="/tags/netgearrax120">netgearrax120</a> #<a href="/tags/network">network</a> #<a href="/tags/wifi">wifi</a> </span> <p><a href="https://www.jp.netgear.com/home/products/networking/wifi-routers/RAX120.aspx">NETGEAR AX12 RAX120</a>というWifiルーターを新しく導入しました。</p> <p>少し前まで<a href="https://www.synology.com/ja-jp/products/MR2200ac">Synology MR2200ac</a>というルーターを使っていましたが、頻繁にインターネット接続が切れてしまい、またルーターを再起動しないと復元しませんでした。ルーターのログや統計情報を見てみるとうまくいかない状況下ではルーターのCPU使用率がかなり上がっており、Load averageで4〜5 (いつもは1未満)になっているようでした。 このことから、おそらくCPUスペックが不足しているだろうということでより強力なCPUをもつルーターを探して入れ替えることにしました。</p> <h1 id="消去法にて">消去法にて</h1> <p>自宅ネットワーク環境は<a href="https://www.iijmio.jp/imh/">IIJmioひかり</a>のIPoEオプションを契約しています。DS-Liteに対応したルーターを選ぶことになりました。探してみるとまだあまり<a href="https://www.mfeed.ad.jp/transix/dslite/dslite.html#transix-ipv4%E6%8E%A5%E7%B6%9A-ds-lite-%E5%AF%BE%E5%BF%9C%E6%A9%9F%E7%A8%AE">対応製品</a>は多くないようで、Wifi 6に対応したものに狭めるとまた選択肢が狭まりました。さらにアンテナがあまりトゲトゲと飛び出していないものにしたかったので消去法にて<a href="https://www.jp.netgear.com/home/products/networking/wifi-routers/RAX120.aspx">NETGEAR AX12 RAX120</a>に決定しました。</p> <h1 id="評価">評価</h1> <p>電波強度は申し分ないのですが、どちらかというとSynology MR2200acと比べ劣ると感じる部分がいくつかありますのでそちらを紹介していきます。</p> <h2 id="ログが使い物にならない">ログが使い物にならない</h2> <p><img src="/images/2020-07-29-netgear-rax120.png" alt="ログ"/></p> <p>管理画面からログを取得できますが、このログはほとんど使い物になりません。まず、ログに時刻が含まれない。さらに、ログ1行の長さが128バイトを超えると超過分は無視され記録され全文は読み取れません。ログをメールで送信する設定をした際もエラーが全文読み取れず、原因はついに分からずじまいでした。</p> <p>iPhoneなどからの接続が時々切れているように見え、iPhone側からは接続ができているように見えていたのでDHCP問題かと思い調べようとしたところ、それに繋がりそうなログは一切表示されませんでした。DS-Liteの設定時も接続画面ではエラーと表示されるが具体的に何が失敗したのかはわかりませんでした。</p> <p>実用上、本機にログ取得・表示機能は無いと考えた方が良いでしょう。このあたりは是非改善していただきたいところです。</p> <h2 id="web-guiは貧弱">Web GUIは貧弱</h2> <p>スマートフォンアプリにて管理機能がありますがこちらはなかなか項目もシンプルで表示も見やすく、よくできていると思います。</p> <p>一方、Web GUIについてはSynologyのGUIは非常に良くできているのでこの2機種で対比するとNETGEAR側がかなり見劣りすると言わざるを得ないでしょう。CPUやメモリ利用の統計情報も時系列情報はありませんし、ログとしても取り出せないようです。</p> <p>GUIは初期設定と、トラブル対応時くらいしか利用しませんからトラブルさえなければこの評価の重要性は状況によって大きく変わります。今回引き続きネットワーク接続の問題が出ているので手がかりがほぼゼロと言えるNETGEARのGUIは満足度を酷く低下させるものでした。</p> <p>Synologyでもネットワーク接続断の問題は最終的に問題解決には至りませんでしたが、統計情報やエラーなど情報が見えることによる安心感があったように思います。</p> <h2 id="netgear-armor">NETGEAR ARMOR</h2> <p><a href="https://www.jp.netgear.com/landings/armor/">NETGEAR ARMOR</a>というBitdefenderによる脆弱性スキャン、脅威の自動ブロック、アンチマルウエアソフトウエアが年間サブスクリプションでの追加オプションとして利用できます。</p> <p>幸いなことにまだ脅威となるインシデントは発生していないのでどの程度の安心かは未知数ですが、テストなどのために古いiPhoneやAndroidを接続してテストするときには一定の安心感が得られそうです。</p> <h1 id="総評">総評</h1> <p>セットアップもお任せモードが比較的良くできているので、すべてお任せという状態で動けばとても素直なルーターと言えると思います。一方で、何かトラブルが発生したときにはその原因にたどり着くの難しく、賭けの要素が強い製品です。</p> </div> <div class="post"> <h1 class="post-title"> <a href="/2020/07/28/gmail-filter-cli-en/"> Batch Gmail filter creation CLI - watermint toolbox </a> </h1> <span class="post-date"> 28th July 2020</span> <span class="post-tags"> #<a href="/tags/cli">cli</a> #<a href="/tags/gmail">gmail</a> #<a href="/tags/gmailapi">gmailapi</a> #<a href="/tags/google">google</a> #<a href="/tags/googleapi">googleapi</a> #<a href="/tags/toolbox">toolbox</a> #<a href="/tags/waterminttoolbox">waterminttoolbox</a> </span> <p>New Gmail-related commands have been added to the <a href="https://github.com/watermint/toolbox/">watermint toolbox</a>. This allows you to get a list of emails from the command line, add/remove/rename labels, and add/remove filters.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% tbx services google mail label list

watermint toolbox 72.4.544
==========================

© 2016-2020 Takayuki Okazaki
Licensed under open source licenses. Use the `license` command for more detail.

Testing network connection...
Done

Opening the authorization URL:
https://accounts.google.com/o/oauth2/auth?client_id=xxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com&amp;redirect_uri=http%3A%2F%2Flocalhost%3A7800%2Fconnect%2Fauth&amp;response_type=code&amp;scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fgmail.labels&amp;state=xxxxxxxx

Please press ENTER to open the auth page on the browser.

| name                         | type   |
|------------------------------|--------|
| CHAT                         | system |
| SENT                         | system |
| INBOX                        | system |
| IMPORTANT                    | system |
| TRASH                        | system |
| DRAFT                        | system |
| SPAM                         | system |
| CATEGORY_FORUMS              | system |
| CATEGORY_UPDATES             | system |
| CATEGORY_PERSONAL            | system |
| CATEGORY_PROMOTIONS          | system |
| CATEGORY_SOCIAL              | system |
| STARRED                      | system |
| UNREAD                       | system |
| services/google.com          | user   |
| services/accounts.google.com | user   |
| services/youtube.com         | user   |


The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200727-074430.001/report/labels.csv
The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200727-074430.001/report/labels.json
The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200727-074430.001/report/labels.xlsx

</code></pre></div></div> <p>If you want to use it, please use <a href="https://github.com/watermint/toolbox/releases/tag/72.4.544">Release 72</a> or later.</p> <p>I label and manage each source to some extent as I process a variety of emails. This is also a bit of a hassle when the number of source types increases, and I counted the number of labels in the command I created this time, and there are already 343 labels.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% tbx services google mail label list -output json | jq 'select(.type == "user") | .id ' | wc -l
     343
</code></pre></div></div> <p>I checked the number of filters created in the same way and found 474.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% tbx services google mail filter list -output json | wc -l
     474
</code></pre></div></div> <p>I have been making labels and filters by hand for several years now, but it’s getting tedious, so I made it possible to create labels and filters in batches based on certain conditions. So far, it’s not fully automated, but semi-automated once the CSV data file is created.</p> <h2 id="create-the-source-data-for-the-labelfilter-you-want-to-create">Create the source data for the label/filter you want to create.</h2> <p>There are two types of Gmail labels. (1) system labels that are automatically assigned by Gmail, such as INBOX and SPAM, and (2) user-defined user labels. In this time, I’m going to get the list of emails in INBOX and get the data with no user labels attached. In this case, I will add label conditions based on the destination address and source address of the email.</p> <p>First of all, get the email data, get the source address, and make rules for each domain. I’ve omitted quite a bit, but I get the mail data in JSON format, process it with the jq command and output it as CSV. The first column is the query, the second column is the label to be added, and the third column is the label to be removed. The third column is not specified. If you want to archive automatically, you can do so by deleting INBOX.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% tbx services google mail message processed list -output json | jq -r 'select(.label_type_user | length ==0) | .from.address | ["from:"+., "services/"+capture("@(?&lt;d&gt;\\b([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}\\b)").d] | @csv' | sort -u
"from:families-noreply@google.com","services/google.com"
"from:googlecommunityteam-noreply@google.com","services/google.com"
"from:no-reply@accounts.google.com","services/accounts.google.com"
"from:no-reply@google.com","services/google.com"
"from:noreply-purchases@youtube.com","services/youtube.com"
</code></pre></div></div> <p>Create a batch filter based on this data. It also automatically creates any missing labels and applies them to the messages in the INBOX.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% tbx services google mail filter batch add -add-label-if-not-exist -apply-to-inbox-messages -peer waterlandpier -file ~/filters.csv

watermint toolbox `dev`
=======================

© 2016-2020 Takayuki Okazaki
Licensed under open source licenses. Use the `license` command for more detail.

Creating a filter: from:families-noreply@google.com
from:families-noreply@google.com: Updating message 1
from:families-noreply@google.com: Updating message 2
Creating a filter: from:googlecommunityteam-noreply@google.com
from:googlecommunityteam-noreply@google.com: Updating message 1
Creating a filter: from:no-reply@accounts.google.com
from:no-reply@accounts.google.com: Updating message 1
from:no-reply@accounts.google.com: Updating message 2
from:no-reply@accounts.google.com: Updating message 3
from:no-reply@accounts.google.com: Updating message 4
from:no-reply@accounts.google.com: Updating message 5
from:no-reply@accounts.google.com: Updating message 6
from:no-reply@accounts.google.com: Updating message 7
Creating a filter: from:no-reply@google.com
Creating a filter: from:noreply-purchases@youtube.com
from:noreply-purchases@youtube.com: Updating message 1

| status | reason | input.query                                 | input.add_labels             | input.delete_labels | result.id                              | result.criteria_from | result.criteria_to | result.criteria_subject | result.criteria_query                       | result.criteria_negated_query |
|--------|--------|---------------------------------------------|------------------------------|---------------------|----------------------------------------|----------------------|--------------------|-------------------------|---------------------------------------------|-------------------------------|
| 成功   |        | from:families-noreply@google.com            | services/google.com          |                     | xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |                      |                    |                         | from:families-noreply@google.com            |                               |
| 成功   |        | from:googlecommunityteam-noreply@google.com | services/google.com          |                     | xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |                      |                    |                         | from:googlecommunityteam-noreply@google.com |                               |
| 成功   |        | from:no-reply@accounts.google.com           | services/accounts.google.com |                     | xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |                      |                    |                         | from:no-reply@accounts.google.com           |                               |
| 成功   |        | from:no-reply@google.com                    | services/google.com          |                     | xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxx |                      |                    |                         | from:no-reply@google.com                    |                               |
| 成功   |        | from:noreply-purchases@youtube.com          | services/youtube.com         |                     | xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |                      |                    |                         | from:noreply-purchases@youtube.com          |                               |


The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200726-223228.001/report/filters.csv
The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200726-223228.001/report/filters.json
The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200726-223228.001/report/filters.xlsx
The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200726-223228.001/report/messages.csv
The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200726-223228.001/report/messages.json
The report generated: /xxxxx/xxxxxxxx/.toolbox/jobs/20200726-223228.001/report/messages.xlsx
</code></pre></div></div> <p>I don’t usually have time to create filters in batches, so I’m hoping this will make my email processing a little more efficient.</p> </div> </div> <div class="pagination"> <a class="pagination-item older" href="/page3">Older</a> <a class="pagination-item newer" href="/">Newer</a> </div> </div> <div class="container copyright"> &copy; 2007, 2013-2022 Takayuki Okazaki </div> </div> <label for="sidebar-checkbox" class="sidebar-toggle"></label> <script>!function(e){var r=e.querySelector(".sidebar-toggle"),t=e.querySelector("#sidebar"),n=e.querySelector("#sidebar-checkbox");e.addEventListener("click",function(e){var c=e.target;n.checked&&!t.contains(c)&&c!==n&&c!==r&&(n.checked=!1)},!1)}(document);</script> </body> </html>